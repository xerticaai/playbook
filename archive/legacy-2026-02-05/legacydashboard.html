<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Xertica.ai - Intelligence Dashboard</title>
  <link rel="icon" type="image/png" href="https://storage.googleapis.com/etp-bucket/Logos%20Xertica.ai%20(.png)/X%20-%20simbolo/Copy%20of%20X_symbol_variation3_Blue_white.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    /* SVG Icons */
    .icon { width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-right: 8px; }
    .icon-lg { width: 28px; height: 28px; }
    .kpi-card .icon-lg { position: absolute; top: 15px; right: 15px; opacity: 0.2; }
  </style>
  <style>
    :root {
      --bg-dark: #1c2b3e;
      --bg-card: #24344d;
      --primary-cyan: #00BEFF;
      --text-white: #ffffff;
      --text-gray: #b0b8c4;
      --success: #C0FF7D;
      --danger: #E14849;
      --warning: #FFA500;
    }
    
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Roboto', sans-serif; background-color: var(--bg-dark); color: var(--text-white); display: flex; height: 100vh; overflow: hidden; }
    
    /* Sidebar */
    .sidebar { width: 250px; background: rgba(0,0,0,0.2); border-right: 1px solid rgba(255,255,255,0.05); padding: 20px; display: flex; flex-direction: column; }
    .logo { font-family: 'Poppins', sans-serif; font-weight: 700; font-size: 24px; color: var(--text-white); margin-bottom: 40px; letter-spacing: 1px; }
    .logo span { color: var(--primary-cyan); }
    .logo img { transition: opacity 0.3s ease; }
    .logo:hover img { opacity: 0.8; }
    .nav-item { padding: 12px 15px; margin: 5px 0; border-radius: 8px; cursor: pointer; transition: all 0.3s; font-weight: 500; user-select: none; }
    .nav-item:hover, .nav-item.active { background: rgba(0, 190, 255, 0.15); color: var(--primary-cyan); box-shadow: 0 0 10px rgba(0,190,255,0.1); }

    /* Main Content */
    .main { flex: 1; padding: 30px; overflow-y: auto; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    h1, h2, h3, h4 { font-family: 'Poppins', sans-serif; margin: 0; }
    h3 { margin-bottom: 20px; color: var(--text-white); }
    h4 { color: var(--primary-cyan); margin: 20px 0 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; font-size: 16px; }
    .timestamp { font-size: 12px; color: var(--text-gray); }

    /* AI Analysis Card */
    .ai-card { background: linear-gradient(135deg, rgba(0,190,255,0.1) 0%, rgba(28,43,62,1) 100%); border: 1px solid rgba(0,190,255,0.3); padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 0 20px rgba(0,190,255,0.1); }
    .ai-card h2 { color: var(--primary-cyan); font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
    .ai-content { font-size: 15px; line-height: 1.8; color: #e0e6ed; }

    /* KPI Grid */
    .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
    .kpi-card { background: var(--bg-card); padding: 18px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); transition: transform 0.2s; position: relative; overflow: hidden; }
    .kpi-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,190,255,0.1); }
    .kpi-card .icon-lg { position: absolute; top: 15px; right: 15px; opacity: 0.2; }
    .kpi-title { font-size: 11px; color: var(--text-gray); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
    .kpi-value { font-size: 26px; font-weight: 700; font-family: 'Poppins', sans-serif; margin-top: 8px; }
    .kpi-subtitle { font-size: 12px; color: var(--text-gray); margin-top: 5px; }
    .val-green { color: var(--success); }
    .val-red { color: var(--danger); }
    .val-cyan { color: var(--primary-cyan); }
    .val-warning { color: var(--warning); }

    /* Tables */
    table { width: 100%; border-collapse: collapse; margin-top: 15px; background: var(--bg-card); border-radius: 8px; overflow: hidden; }
    th { text-align: left; color: var(--text-gray); font-size: 11px; text-transform: uppercase; padding: 12px 15px; border-bottom: 2px solid rgba(255,255,255,0.1); font-weight: 600; letter-spacing: 0.5px; }
    td { padding: 12px 15px; border-bottom: 1px solid rgba(255,255,255,0.03); font-size: 13px; }
    tr:hover { background: rgba(255,255,255,0.02); }
    tr:last-child td { border-bottom: none; }
    .badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; display: inline-block; }
    .badge-success { background: rgba(192, 255, 125, 0.15); color: var(--success); }
    .badge-danger { background: rgba(225, 72, 73, 0.15); color: var(--danger); }
    .badge-warning { background: rgba(255, 165, 0, 0.15); color: var(--warning); }

    /* Deal Cards (Pauta) */
    .deal-card { background: var(--bg-card); padding: 15px; margin-bottom: 12px; border-radius: 8px; border-left: 3px solid var(--primary-cyan); transition: all 0.2s; }
    .deal-card:hover { background: rgba(36, 52, 77, 0.8); transform: translateX(3px); }
    .deal-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px; }
    .deal-name { font-weight: 600; font-size: 14px; color: var(--text-white); }
    .deal-value { font-weight: 700; color: var(--primary-cyan); font-size: 15px; }
    .deal-meta { font-size: 12px; color: var(--text-gray); line-height: 1.6; }
    .deal-audit { font-size: 12px; color: #cbd5e0; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.05); font-style: italic; }

    /* Margin Category Grid */
    .margin-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-top: 15px; }
    .margin-card { background: rgba(0,190,255,0.05); padding: 12px; border-radius: 8px; border: 1px solid rgba(0,190,255,0.1); text-align: center; }
    .margin-card-title { font-size: 11px; color: var(--text-gray); text-transform: uppercase; }
    .margin-card-value { font-size: 22px; font-weight: 700; color: var(--primary-cyan); margin: 5px 0; }
    .margin-card-sub { font-size: 11px; color: var(--text-gray); }

    /* Sections Control */
    .section { display: none; animation: fadeIn 0.4s ease; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* Loading State */
    .loading { text-align: center; padding: 40px; color: var(--text-gray); }
    
    /* Executive Tabs */
    .exec-tab.active {
      color: var(--primary-cyan) !important;
      border-bottom: 3px solid var(--primary-cyan) !important;
    }
    .exec-tab:hover {
      color: var(--text-white);
    }
    .exec-tab-content {
      animation: fadeIn 0.3s ease;
    }

    /* ML Tabs */
    .ml-tab.active {
      color: var(--primary-cyan) !important;
      border-bottom: 3px solid var(--primary-cyan) !important;
    }
    .ml-tab:hover {
      color: var(--text-white);
    }
    .ml-tab-content {
      animation: fadeIn 0.3s ease;
      display: none;
    }
    .ml-tab-content.active {
      display: block;
    }

    /* Refresh Button */
    .refresh-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--primary-cyan);
      color: var(--bg-dark);
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 190, 255, 0.4);
      transition: all 0.3s ease;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .refresh-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0, 190, 255, 0.6);
    }
    .refresh-btn:active {
      transform: scale(0.95);
    }
    .refresh-btn.loading {
      animation: spin 1s linear infinite;
      background: var(--text-gray);
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="logo" style="display: flex; align-items: center; gap: 10px;">
      <img src="https://storage.googleapis.com/etp-bucket/Logos%20Xertica.ai%20(.png)/X%20-%20simbolo/Copy%20of%20X_symbol_variation3_Blue_white.png" alt="Xertica" style="height: 32px; width: auto;">
      <img src="https://storage.googleapis.com/etp-bucket/Logos%20Xertica.ai%20(.png)/xertica.ai/Copy%20of%20Logo_XERTICA_white.png" alt="Xertica.ai" style="height: 24px; width: auto; margin-top: 4px;">
    </div>
    <div class="nav-item active" onclick="showSection(this, 'executive')">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
        <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
      </svg>
      Vis√£o Executiva
    </div>
    <div class="nav-item" onclick="showSection(this, 'dashboard')">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2"/>
        <path d="M9 9h6M9 15h6"/>
      </svg>
      Indicadores L10
    </div>
    <div class="nav-item" onclick="showSection(this, 'insights')">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 16v-4M12 8h.01"/>
      </svg>
      Aprendizados
    </div>
    <div class="nav-item" onclick="showSection(this, 'fsr')">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="4"/>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>
      Performance FSR
    </div>
    <div class="nav-item" onclick="showSection(this, 'individual')">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="12" cy="7" r="4"/>
      </svg>
      Por Vendedor
    </div>
    <div class="nav-item" onclick="showSection(this, 'agenda')">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
        <line x1="16" y1="2" x2="16" y2="6"/>
        <line x1="8" y1="2" x2="8" y2="6"/>
        <line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
      Pauta Semanal
    </div>
    <div class="nav-item" onclick="showSection(this, 'ml')">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="2"/>
        <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
      </svg>
      ü§ñ Intelig√™ncia ML
    </div>
  </div>

  <div class="main">
    <div class="header">
      <h1 id="page-title">‚ö° XAnalysis Dashboard</h1>
      <div class="timestamp">
        <span id="quarter-label">-</span> | 
        Atualizado: <span id="last-update">-</span>
      </div>
    </div>
    
    <!-- Bot√£o de Atualizar -->
    <button class="refresh-btn" onclick="clearDashboardCache()" title="Atualizar Dashboard (Limpa Cache)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 28px; height: 28px;">
        <polyline points="23 4 23 10 17 10"/>
        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
      </svg>
    </button>

    <!-- SE√á√ÉO 0: VIS√ÉO EXECUTIVA (NOVA) -->
    <div id="executive" class="section active">
      <!-- TABS DA VIS√ÉO EXECUTIVA -->
      <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 0;">
        <button class="exec-tab active" data-tab="resumo" onclick="switchExecTab('resumo')" style="
          background: none; 
          border: none; 
          color: var(--text-gray); 
          padding: 12px 20px; 
          cursor: pointer; 
          font-weight: 600; 
          font-size: 14px;
          border-bottom: 3px solid transparent;
          transition: all 0.3s;
        ">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px;">
            <line x1="18" y1="20" x2="18" y2="10"/>
            <line x1="12" y1="20" x2="12" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="14"/>
          </svg>
          Resumo do Quarter
        </button>
        <button class="exec-tab" data-tab="mapas" onclick="switchExecTab('mapas')" style="
          background: none; 
          border: none; 
          color: var(--text-gray); 
          padding: 12px 20px; 
          cursor: pointer; 
          font-weight: 600; 
          font-size: 14px;
          border-bottom: 3px solid transparent;
          transition: all 0.3s;
        ">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px;">
            <circle cx="12" cy="12" r="3"/>
            <circle cx="19" cy="5" r="2"/>
            <circle cx="5" cy="5" r="2"/>
            <circle cx="19" cy="19" r="2"/>
            <circle cx="5" cy="19" r="2"/>
            <path d="M12 9v6m0-6l7-4M12 9L5 5m7 10l7 4m-7-4l-7 4"/>
          </svg>
          Mapa de Palavras
        </button>
        <button class="exec-tab" data-tab="oportunidades" onclick="switchExecTab('oportunidades')" style="
          background: none; 
          border: none; 
          color: var(--text-gray); 
          padding: 12px 20px; 
          cursor: pointer; 
          font-weight: 600; 
          font-size: 14px;
          border-bottom: 3px solid transparent;
          transition: all 0.3s;
        ">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px;">
            <circle cx="12" cy="12" r="10"/>
            <circle cx="12" cy="12" r="6"/>
            <circle cx="12" cy="12" r="2"/>
          </svg>
          Principais Oportunidades
        </button>
        <button class="exec-tab" data-tab="guia" onclick="switchExecTab('guia')" style="
          background: none; 
          border: none; 
          color: var(--text-gray); 
          padding: 12px 20px; 
          cursor: pointer; 
          font-weight: 600; 
          font-size: 14px;
          border-bottom: 3px solid transparent;
          transition: all 0.3s;
        ">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px;">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="16" x2="12" y2="12"/>
            <line x1="12" y1="8" x2="12.01" y2="8"/>
          </svg>
          Como Interpretar
        </button>
      </div>

      <!-- TAB CONTENT: RESUMO -->
      <div class="exec-tab-content active" data-content="resumo">
      <!-- SE√á√ÉO 1: O PLACAR DO QUARTER -->
      <h3>
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2L2 7l10 5 10-5-10-5z"/>
          <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
        </svg>
        O Placar do Quarter
      </h3>
      <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 15px 0;">Onde estamos vs. onde queremos chegar</p>
      
      <!-- Filtros de Per√≠odo -->
      <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; padding: 12px; background: rgba(176,184,196,0.05); border-radius: 8px; border: 1px solid rgba(176,184,196,0.15); align-items: center;">
        <span style="font-size: 12px; color: var(--text-gray); font-weight: 600; margin-right: 8px; display: flex; align-items: center; gap: 6px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          FILTRAR PIPELINE:
        </span>
        <button class="period-filter active" data-period="all" onclick="filterPipeline('all')" style="padding: 8px 16px; border-radius: 6px; border: 1px solid var(--primary-cyan); background: rgba(0,190,255,0.15); color: var(--primary-cyan); cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s; box-shadow: 0 2px 4px rgba(0,190,255,0.2); display: flex; align-items: center; gap: 6px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
          Todo Pipeline (Todos Anos)
        </button>
        <button class="period-filter" data-period="total" onclick="filterPipeline('total')" style="padding: 8px 16px; border-radius: 6px; border: 1px solid rgba(176,184,196,0.3); background: transparent; color: var(--text-gray); cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.3s; box-shadow: 0 1px 2px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 6px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
          <span id="filter-total-label">Todo Pipeline (FY26)</span>
        </button>
        <button class="period-filter" data-period="q1" onclick="filterPipeline('q1')" style="padding: 8px 16px; border-radius: 6px; border: 1px solid rgba(176,184,196,0.3); background: transparent; color: var(--text-gray); cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.3s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
          <span id="filter-q1-label">Q1 FY26</span>
        </button>
        <button class="period-filter" data-period="q2" onclick="filterPipeline('q2')" style="padding: 8px 16px; border-radius: 6px; border: 1px solid rgba(176,184,196,0.3); background: transparent; color: var(--text-gray); cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.3s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
          <span id="filter-q2-label">Q2 FY26</span>
        </button>
        <button class="period-filter" data-period="q3" onclick="filterPipeline('q3')" style="padding: 8px 16px; border-radius: 6px; border: 1px solid rgba(176,184,196,0.3); background: transparent; color: var(--text-gray); cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.3s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
          <span id="filter-q3-label">Q3 FY26</span>
        </button>
        <button class="period-filter" data-period="q4" onclick="filterPipeline('q4')" style="padding: 8px 16px; border-radius: 6px; border: 1px solid rgba(176,184,196,0.3); background: transparent; color: var(--text-gray); cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.3s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
          <span id="filter-q4-label">Q4 FY26</span>
        </button>
        
        <!-- Filtro por Vendedor -->
        <div style="margin-left: 20px; display: flex; align-items: center; gap: 8px;">
          <span style="font-size: 12px; color: var(--text-gray); font-weight: 600; display: flex; align-items: center; gap: 6px;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
            VENDEDOR:
          </span>
          <select id="rep-filter" onchange="filterByRep(this.value)" style="padding: 8px 12px; border-radius: 6px; border: 1px solid rgba(176,184,196,0.3); background: var(--bg-primary); color: var(--text-primary); cursor: pointer; font-weight: 500; font-size: 13px; transition: all 0.3s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
            <option value="all">Todos os Vendedores</option>
            <!-- Preenchido dinamicamente -->
          </select>
        </div>
      </div>
      
      <div class="kpi-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
        <div class="kpi-card" style="border-left: 4px solid var(--primary-cyan);">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
            <line x1="12" y1="22.08" x2="12" y2="12"/>
          </svg>
          <div class="kpi-title" style="color: var(--primary-cyan);">Pipeline Total</div>
          <div class="kpi-value" style="color: var(--primary-cyan); font-size: 28px;" id="exec-pipeline-year-total">-</div>
          <div class="kpi-subtitle" id="exec-pipeline-year-deals" style="font-size: 11px; line-height: 1.3;">- deals abertos</div>
          <div class="kpi-subtitle" id="exec-pipeline-year-net" style="font-size: 11px; margin-top: 5px; padding: 3px 8px; background: rgba(16,185,129,0.12); color: var(--success); border-radius: 4px; display: inline-block; font-weight: 600;">Net: -</div>
        </div>
        <div class="kpi-card" style="border-left: 4px solid var(--warning);">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
            <polyline points="17 6 23 6 23 12"/>
          </svg>
          <div class="kpi-title" style="color: var(--warning);">Pipeline (Per√≠odo Filtrado)</div>
          <div class="kpi-value" style="color: var(--warning); font-size: 28px;" id="exec-pipeline-total">-</div>
          <div class="kpi-subtitle" id="exec-pipeline-deals" style="font-size: 11px; line-height: 1.3;">- deals no per√≠odo</div>
          <div class="kpi-subtitle" id="exec-pipeline-net" style="font-size: 11px; margin-top: 5px; padding: 3px 8px; background: rgba(16,185,129,0.12); color: var(--success); border-radius: 4px; display: inline-block; font-weight: 600;">Net: -</div>
        </div>
        <div class="kpi-card" style="border-left: 4px solid var(--success);">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
          <div class="kpi-title" style="color: var(--success);">Previs√£o Sales Specialist</div>
          <div class="kpi-value" style="color: var(--success); font-size: 28px;" id="exec-pipeline-specialist-total">-</div>
          <div class="kpi-subtitle" id="exec-pipeline-specialist-deals" style="font-size: 11px; line-height: 1.3;">- deals curados</div>
          <div class="kpi-subtitle" id="exec-pipeline-specialist-net" style="font-size: 11px; margin-top: 5px; padding: 3px 8px; background: rgba(16,185,129,0.12); color: var(--success); border-radius: 4px; display: inline-block; font-weight: 600;">Net: -</div>
        </div>
        <div class="kpi-card">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
          </svg>
          <div class="kpi-title">Previs√£o Ponderada IA</div>
          <div class="kpi-value val-warning" id="exec-forecast-weighted">-</div>
          <div class="kpi-subtitle" id="exec-forecast-percent" style="font-size: 11px; line-height: 1.3;">-% confian√ßa m√©dia</div>
          <div class="kpi-subtitle" id="exec-forecast-net" style="font-size: 11px; margin-top: 5px; padding: 3px 8px; background: rgba(16,185,129,0.12); color: var(--success); border-radius: 4px; display: inline-block; font-weight: 600;">Net: -</div>
        </div>
        <div class="kpi-card">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
          </svg>
          <div class="kpi-title">Deals ‚â•50% Confian√ßa IA</div>
          <div class="kpi-value val-cyan" id="exec-above50-value">-</div>
          <div class="kpi-subtitle" id="exec-above50-count" style="font-size: 11px; line-height: 1.3;">- deals</div>
          <div class="kpi-subtitle" id="exec-above50-net" style="font-size: 11px; margin-top: 5px; padding: 3px 8px; background: rgba(16,185,129,0.12); color: var(--success); border-radius: 4px; display: inline-block; font-weight: 600;">Net: -</div>
        </div>
        <div class="kpi-card">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <div class="kpi-title">Fechado no Quarter</div>
          <div class="kpi-value val-green" id="exec-closed-total">-</div>
          <div class="kpi-subtitle" id="exec-closed-deals" style="font-size: 11px; line-height: 1.3;">- deals ganhos</div>
          <div class="kpi-subtitle" id="exec-closed-net" style="font-size: 11px; margin-top: 5px; padding: 3px 8px; background: rgba(16,185,129,0.12); color: var(--success); border-radius: 4px; display: inline-block; font-weight: 600;">Net: -</div>
        </div>
        <div class="kpi-card">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M16 12l-4-4-4 4M12 16V8"/>
          </svg>
          <div class="kpi-title">Taxa de Convers√£o</div>
          <div class="kpi-value val-cyan" id="exec-conversion-rate">-</div>
          <div class="kpi-subtitle" id="exec-conversion-detail">-</div>
        </div>
        <div class="kpi-card" style="border-left: 4px solid var(--primary-purple);">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
          <div class="kpi-title" style="color: var(--primary-purple);">Vendedores Ativos</div>
          <div class="kpi-value" style="color: var(--primary-purple); font-size: 28px;" id="exec-active-reps">-</div>
          <div class="kpi-subtitle" id="exec-winrate" style="font-size: 11px; line-height: 1.3;">Win Rate: -</div>
        </div>
      </div>

      <!-- Sa√∫de do Forecast (Barra Visual) -->
      <div style="margin: 25px 0;">
        <h4 style="font-size: 13px; margin-bottom: 10px; border: none; padding-bottom: 0; color: var(--text-gray); display: flex; align-items: center; gap: 8px;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
            <path d="M2 17l10 5 10-5"/>
            <path d="M2 12l10 5 10-5"/>
          </svg>
          Sa√∫de do Forecast - An√°lise IA (Por Confian√ßa)
        </h4>
        <div style="display: flex; gap: 8px; height: 40px; border-radius: 8px; overflow: hidden; background: var(--bg-card); box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);">
          <div id="forecast-commit-bar" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; color: white; transition: all 0.3s; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">-</div>
          <div id="forecast-upside-bar" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; color: white; transition: all 0.3s; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">-</div>
          <div id="forecast-pipeline-bar" style="background: linear-gradient(135deg, #00BEFF 0%, #0080AA 100%); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; color: white; transition: all 0.3s; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">-</div>
        </div>
        <div style="display: flex; gap: 15px; margin-top: 10px; font-size: 11px; flex-wrap: wrap;">
          <span style="color: var(--success); font-weight: 600;">‚óè COMMIT (‚â•90%): <span id="forecast-commit-value">-</span></span>
          <span style="color: var(--warning); font-weight: 600;">‚óè UPSIDE (50-89%): <span id="forecast-upside-value">-</span></span>
          <span style="color: var(--primary-cyan); font-weight: 600;">‚óè PIPELINE (<50%): <span id="forecast-pipeline-value">-</span></span>
        </div>
      </div>

      <!-- Sa√∫de do Forecast - Sales Specialist (Manual) -->
      <div style="margin: 25px 0;">
        <h4 style="font-size: 13px; margin-bottom: 10px; border: none; padding-bottom: 0; color: var(--text-gray); display: flex; align-items: center; gap: 8px;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px;">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
          Sa√∫de do Forecast - Sales Specialist (Curadoria Manual)
        </h4>
        <div style="display: flex; gap: 8px; height: 40px; border-radius: 8px; overflow: hidden; background: var(--bg-card); box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);">
          <div id="forecast-ss-commit-bar" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; color: white; transition: all 0.3s; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">-</div>
          <div id="forecast-ss-upside-bar" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; color: white; transition: all 0.3s; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">-</div>
        </div>
        <div style="display: flex; gap: 15px; margin-top: 10px; font-size: 11px; flex-wrap: wrap;">
          <span style="color: var(--success); font-weight: 600;">‚óè COMMIT: <span id="forecast-ss-commit-value">-</span></span>
          <span style="color: var(--warning); font-weight: 600;">‚óè UPSIDE: <span id="forecast-ss-upside-value">-</span></span>
        </div>
      </div>

      <!-- SE√á√ÉO 2: AN√ÅLISE ESTRAT√âGICA DA IA -->
      <div class="ai-card" style="margin-top: 30px;">
        <h2>
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
          </svg>
          An√°lise Estrat√©gica (IA)
        </h2>
        <div id="executive-content" class="ai-content">
          <div class="loading">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
              <polyline points="23 4 23 10 17 10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
            Carregando an√°lise executiva...
          </div>
        </div>
      </div>

      <!-- SE√á√ÉO 3: DESTAQUES OPERACIONAIS DO QUARTER -->
      <h3 style="margin-top: 40px;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 16v-4M12 8h.01"/>
        </svg>
        Destaques Operacionais do Quarter
      </h3>
      <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 15px 0;">Onde focar a energia agora</p>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px;">
        <!-- Card 1: Oportunidade-Chave -->
        <div class="deal-card" style="border-left-color: var(--warning);">
          <div style="font-size: 10px; color: var(--warning); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">‚ö° Oportunidade-Chave #1</div>
          <div class="deal-header">
            <div class="deal-name" id="exec-key-opp-name">-</div>
            <div class="deal-value" id="exec-key-opp-value">-</div>
          </div>
          <div class="deal-meta">
            <strong>Vendedor:</strong> <span id="exec-key-opp-owner">-</span><br>
            <strong>Por que √© principal:</strong> <span id="exec-key-opp-why">-</span><br>
            <strong>Principal Risco:</strong> <span id="exec-key-opp-risk" style="color: var(--danger);">-</span>
          </div>
        </div>

        <!-- Card 2: Vit√≥ria Destaque -->
        <div class="deal-card" style="border-left-color: var(--success);">
          <div style="font-size: 10px; color: var(--success); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600; display: flex; align-items: center; gap: 6px;">
            <svg viewBox="0 0 24 24" fill="currentColor" style="width: 14px; height: 14px;">
              <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
            </svg>
            Vit√≥ria Destaque
          </div>
          <div class="deal-header">
            <div class="deal-name" id="exec-top-win-name">-</div>
            <div class="deal-value" style="color: var(--success);" id="exec-top-win-value">-</div>
          </div>
          <div class="deal-meta">
            <strong>Vendedor:</strong> <span id="exec-top-win-owner">-</span><br>
            <strong>Por que ganhamos:</strong> <span id="exec-top-win-why" style="color: var(--success);">-</span>
          </div>
        </div>

        <!-- Card 3: Perda Destaque -->
        <div class="deal-card" style="border-left-color: var(--danger);">
          <div style="font-size: 10px; color: var(--danger); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">‚ö†Ô∏è Perda Destaque</div>
          <div class="deal-header">
            <div class="deal-name" id="exec-top-loss-name">-</div>
            <div class="deal-value" style="color: var(--danger);" id="exec-top-loss-value">-</div>
          </div>
          <div class="deal-meta">
            <strong>Vendedor:</strong> <span id="exec-top-loss-owner">-</span><br>
            <strong>Por que perdemos:</strong> <span id="exec-top-loss-why" style="color: var(--danger);">-</span>
          </div>
        </div>
      </div>

      <!-- SE√á√ÉO 4: DESTAQUES DA EQUIPE NO QUARTER -->
      <h3 style="margin-top: 40px;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        Destaques da Equipe no Quarter
      </h3>
      <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 15px 0;">Quem est√° brilhando e quem precisa de ajuda</p>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
        <!-- Card: MVP do Quarter -->
        <div class="ai-card" style="background: linear-gradient(135deg, rgba(192,255,125,0.1) 0%, rgba(28,43,62,1) 100%); border-color: var(--success);">
          <h2 style="color: var(--success); font-size: 16px;">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            MVP do Quarter
          </h2>
          <div style="display: flex; align-items: center; gap: 15px; margin-top: 15px;">
            <div style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--success), var(--primary-cyan)); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; color: var(--bg-dark);" id="exec-mvp-initial">-</div>
            <div style="flex: 1;">
              <div style="font-size: 18px; font-weight: 700; color: var(--text-white); margin-bottom: 5px;" id="exec-mvp-name">-</div>
              <div style="font-size: 13px; color: var(--text-gray); line-height: 1.6;" id="exec-mvp-reason">-</div>
            </div>
          </div>
        </div>

        <!-- Card: Ponto de Aten√ß√£o -->
        <div class="ai-card" style="background: linear-gradient(135deg, rgba(225,72,73,0.1) 0%, rgba(28,43,62,1) 100%); border-color: var(--danger);">
          <h2 style="color: var(--danger); font-size: 16px;">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
              <line x1="12" y1="9" x2="12" y2="13"/>
              <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            Ponto de Aten√ß√£o
          </h2>
          <div style="display: flex; align-items: center; gap: 15px; margin-top: 15px;">
            <div style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--danger), var(--warning)); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 700; color: var(--bg-dark);" id="exec-attention-initial">-</div>
            <div style="flex: 1;">
              <div style="font-size: 18px; font-weight: 700; color: var(--text-white); margin-bottom: 5px;" id="exec-attention-name">-</div>
              <div style="font-size: 13px; color: var(--text-gray); line-height: 1.6;" id="exec-attention-reason">-</div>
            </div>
          </div>
        </div>
      </div>

      </div><!-- FIM TAB RESUMO -->

      <!-- TAB CONTENT: MAPA DE PALAVRAS -->
      <div class="exec-tab-content" data-content="mapas" style="display: none;">
      
      <!-- SE√á√ÉO 6: MAPA DE FLAGS DE RISCO -->
      <h3 style="margin-top: 0;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
          <line x1="12" y1="9" x2="12" y2="13"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        Flags de Risco do Pipeline
      </h3>
      <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 15px 0;">Principais alertas e padr√µes de risco identificados</p>
      
      <div id="exec-risk-flags-container" class="ai-card" style="padding: 20px;">
        <div class="loading">Processando flags de risco...</div>
      </div>

      <!-- SE√á√ÉO 7: LABELS DE A√á√ÉO DO PIPELINE -->
      <h3 style="margin-top: 30px;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
          <path d="M9 12h6m-6 4h6"/>
        </svg>
        Labels de A√ß√£o do Pipeline
      </h3>
      <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 15px 0;">A√ß√µes priorit√°rias recomendadas pela IA para acelerar fechamento</p>
      
      <div id="exec-action-labels-container" class="ai-card" style="padding: 20px;">
        <div class="loading">Processando labels de a√ß√£o...</div>
      </div>

      <!-- SE√á√ÉO 8: PERFIL DE VIT√ìRIAS -->
      <h3 style="margin-top: 30px;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        Perfil de Vit√≥rias
      </h3>
      <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 15px 0;">Categoriza√ß√£o dos tipos de deals ganhos</p>
      
      <div id="exec-win-types-container" class="ai-card" style="padding: 20px;">
        <div class="loading">Processando perfil de vit√≥rias...</div>
      </div>

      <!-- SE√á√ÉO 9: PERFIL DE PERDAS -->
      <h3 style="margin-top: 30px;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="15" y1="9" x2="9" y2="15"/>
          <line x1="9" y1="9" x2="15" y2="15"/>
        </svg>
        Perfil de Perdas
      </h3>
      <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 15px 0;">Categoriza√ß√£o dos tipos de deals perdidos</p>
      
      <div id="exec-loss-types-container" class="ai-card" style="padding: 20px;">
        <div class="loading">Processando perfil de perdas...</div>
      </div>

      <!-- SE√á√ÉO 10: PADR√ïES DE SUCESSO -->
      <h3 style="margin-top: 30px;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
        Padr√µes de Sucesso
      </h3>
      <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 15px 0;">Tags e caracter√≠sticas comuns em vit√≥rias</p>
      
      <div id="exec-win-labels-container" class="ai-card" style="padding: 20px;">
        <div class="loading">Processando padr√µes de sucesso...</div>
      </div>

      <!-- SE√á√ÉO 11: PADR√ïES DE PERDA -->
      <h3 style="margin-top: 30px;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
          <line x1="12" y1="9" x2="12" y2="13"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        Padr√µes de Perda
      </h3>
      <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 15px 0;">Tags e caracter√≠sticas comuns em perdas</p>
      
      <div id="exec-loss-labels-container" class="ai-card" style="padding: 20px;">
        <div class="loading">Processando padr√µes de perda...</div>
      </div>

      </div><!-- FIM TAB MAPA DE PALAVRAS -->

      <!-- TAB CONTENT: PRINCIPAIS OPORTUNIDADES -->
      <div class="exec-tab-content" data-content="oportunidades" style="display: none;">
        <h3>
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          Top 5 Oportunidades do Quarter
        </h3>
        <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 15px 0;">An√°lise detalhada dos principais deals em aberto</p>
        
        <!-- An√°lise de IA das Principais Oportunidades -->
        <div class="ai-card" style="margin-bottom: 25px;">
          <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="toggleAIAnalysis()">
            <h2 style="font-size: 16px; margin: 0;">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
              </svg>
              Vis√£o Estrat√©gica das Principais Oportunidades (IA)
            </h2>
            <svg id="ai-analysis-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px; transition: transform 0.3s;">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </div>
          <div id="exec-top-opps-ai-analysis" class="ai-content" style="margin-top: 15px;">
            <div class="loading">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                <polyline points="23 4 23 10 17 10"/>
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
              </svg>
              Analisando principais oportunidades...
            </div>
          </div>
        </div>

        <!-- Card Indicador: Total das Principais Oportunidades -->
        <div class="kpi-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 25px;">
          <div class="kpi-card">
            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <div class="kpi-title">Valor Total Top 5</div>
            <div class="kpi-value val-warning" id="exec-top5-total">-</div>
            <div class="kpi-subtitle" id="exec-top5-percent">-% do pipeline total</div>
          </div>
          <div class="kpi-card">
            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="8" x2="12" y2="16"/>
              <line x1="8" y1="12" x2="16" y2="12"/>
            </svg>
            <div class="kpi-title">Confian√ßa M√©dia Top 5</div>
            <div class="kpi-value val-cyan" id="exec-top5-confidence">-</div>
            <div class="kpi-subtitle" id="exec-top5-deals">5 deals</div>
          </div>
        </div>

        <div id="exec-top-opps-container"></div>
      </div><!-- FIM TAB OPORTUNIDADES -->

      <!-- TAB CONTENT: GUIA DE INTERPRETA√á√ÉO -->
      <div class="exec-tab-content" data-content="guia" style="display: none;">
        <h3>
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
          </svg>
          Como Interpretar as M√©tricas da Vis√£o Executiva
        </h3>
        <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 20px 0;">Guia completo para entender cada indicador</p>
        
        <div style="display: grid; gap: 20px;">
          <div class="ai-card">
            <h4 style="color: var(--primary-cyan); margin: 0 0 8px 0; font-size: 14px;">Pipeline Total</h4>
            <p style="margin: 0; color: var(--text-gray); font-size: 13px; line-height: 1.6;">
              Soma de todos os deals <strong>abertos</strong> no quarter atual. Representa o potencial m√°ximo de revenue se todos fecharem.
            </p>
          </div>
          <div class="ai-card">
            <h4 style="color: var(--primary-cyan); margin: 0 0 8px 0; font-size: 14px;">‚ö° Previs√£o Ponderada IA</h4>
            <p style="margin: 0; color: var(--text-gray); font-size: 13px; line-height: 1.6;">
              Valor m√©dio esperado de fechamento baseado na <strong>m√©dia de confian√ßa IA</strong> de todos os deals. Calculado como: <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">Pipeline Total √ó (Confian√ßa M√©dia %)</code>. 
              <br><br><strong>Exemplo:</strong> Se o pipeline √© $1M e a confian√ßa m√©dia √© 60%, a previs√£o ponderada √© $600k.
            </p>
          </div>
          <div class="ai-card">
            <h4 style="color: var(--primary-cyan); margin: 0 0 8px 0; font-size: 14px;">Deals ‚â•50% Confian√ßa IA</h4>
            <p style="margin: 0; color: var(--text-gray); font-size: 13px; line-height: 1.6;">
              Valor total e quantidade de oportunidades com <strong>50% ou mais de confian√ßa IA</strong> de fechar. Representa o pipeline com maior chance real de convers√£o. <strong>Adaptativo ao filtro:</strong> recalcula com base no per√≠odo selecionado (all, FY26, Q1-Q4).
            </p>
          </div>
          <div class="ai-card">
            <h4 style="color: var(--success); margin: 0 0 8px 0; font-size: 14px;">‚úÖ COMMIT (‚â•90% confian√ßa)</h4>
            <p style="margin: 0; color: var(--text-gray); font-size: 13px; line-height: 1.6;">
              Deals com alt√≠ssima probabilidade de fechar. Normalmente pr√≥ximos de assinatura, com obst√°culos j√° resolvidos.
            </p>
          </div>
          <div class="ai-card">
            <h4 style="color: var(--warning); margin: 0 0 8px 0; font-size: 14px;">‚ö†Ô∏è UPSIDE (70-89% confian√ßa)</h4>
            <p style="margin: 0; color: var(--text-gray); font-size: 13px; line-height: 1.6;">
              Oportunidades bem qualificadas e avan√ßadas, mas com algum risco. Requerem acompanhamento ativo.
            </p>
          </div>
          <div class="ai-card">
            <h4 style="color: var(--primary-cyan); margin: 0 0 8px 0; font-size: 14px;">PIPELINE (<70% confian√ßa)</h4>
            <p style="margin: 0; color: var(--text-gray); font-size: 13px; line-height: 1.6;">
              Deals em est√°gio inicial ou com incertezas significativas. Precisam de trabalho para avan√ßar.
            </p>
          </div>
          <div class="ai-card">
            <h4 style="color: var(--primary-cyan); margin: 0 0 8px 0; font-size: 14px;">Taxa de Convers√£o</h4>
            <p style="margin: 0; color: var(--text-gray); font-size: 13px; line-height: 1.6;">
              Percentual de deals <strong>ganhos</strong> vs. total de deals <strong>fechados</strong> (ganhos + perdidos). Indica efetividade do time em converter oportunidades.
            </p>
          </div>
        </div>
      </div><!-- FIM TAB GUIA -->
    </div><!-- FIM EXECUTIVE SECTION -->

    <!-- SE√á√ÉO: INDICADORES L10 -->
    <div id="dashboard" class="section">
      <div class="ai-card">
        <h2>
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
          </svg>
          An√°lise do CRO (IA)
        </h2>
        <div id="ai-content" class="ai-content">
          <div class="loading">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
              <polyline points="23 4 23 10 17 10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
            Carregando intelig√™ncia...
          </div>
        </div>
      </div>

      <h3>
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <path d="M9 9h6M9 15h6"/>
        </svg>
        Indicadores L10 (Semana Anterior)
      </h3>
      <p style="color: var(--text-gray); font-size: 12px; margin: -5px 0 15px 0;">
        <svg class="icon" viewBox="0 0 24 24" fill="currentColor" style="width: 14px; height: 14px;">
          <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
        </svg>
        Per√≠odo: Segunda a Sexta da semana anterior | Base: Oportunidades fechadas (Ganhas)
      </p>
      <div class="kpi-grid">
        <div class="kpi-card">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="1" x2="12" y2="23"/>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
          </svg>
          <div class="kpi-title">Net Revenue Incr.</div>
          <div class="kpi-value val-green" id="kpi-net">-</div>
        </div>
        <div class="kpi-card">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
          </svg>
          <div class="kpi-title">Bookings Incr.</div>
          <div class="kpi-value val-cyan" id="kpi-bookings-gross">-</div>
          <div class="kpi-subtitle" id="kpi-bookings-count">- deals</div>
        </div>
        <div class="kpi-card">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
          </svg>
          <div class="kpi-title">Pipeline Pr√≥x. Semana</div>
          <div class="kpi-value val-cyan" id="kpi-next-week">-</div>
        </div>
        <div class="kpi-card">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
            <polyline points="17 6 23 6 23 12"/>
          </svg>
          <div class="kpi-title">Pipeline Quarter Atual</div>
          <div class="kpi-value val-cyan" id="kpi-quarter">-</div>
        </div>
        <div class="kpi-card">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          <div class="kpi-title">Aging Pipeline (>90d)</div>
          <div class="kpi-value val-red" id="kpi-aging">-</div>
        </div>
        <div class="kpi-card">
          <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M16 12l-4-4-4 4M12 16V8"/>
          </svg>
          <div class="kpi-title">Previsibilidade (Weighted)</div>
          <div class="kpi-value val-cyan" id="kpi-predictable">-</div>
        </div>
      </div>

      <h3>Margem M√©dia por Categoria (Bookings)</h3>
      <div class="margin-grid" id="margin-container"></div>
    </div>

    <!-- SE√á√ÉO 2: APRENDIZADOS (NOVA) -->
    <div id="insights" class="section">
      <h3>
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
        </svg>
        Aprendizados das Vit√≥rias
      </h3>
      <div class="ai-card">
        <div id="wins-insights-content" class="ai-content">
          <div class="loading">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
              <polyline points="23 4 23 10 17 10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
            Analisando padr√µes de sucesso...
          </div>
        </div>
      </div>

      <h4 style="margin-top: 30px;">Top 10 Fatores de Sucesso (Toda a Equipe)</h4>
      <div id="top-win-factors"></div>

      <h3 style="margin-top: 40px;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        Insights de Melhorias (Perdas)
      </h3>
      <div class="ai-card">
        <div id="loss-insights-content" class="ai-content">
          <div class="loading">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
              <polyline points="23 4 23 10 17 10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
            Analisando causas de perda...
          </div>
        </div>
      </div>

      <h4 style="margin-top: 30px;">Top 10 Causas de Perda (Toda a Equipe)</h4>
      <div id="top-loss-causes"></div>
    </div>

    <!-- SE√á√ÉO 3: PERFORMANCE FSR -->
    <div id="fsr" class="section">
      <!-- NOVO: Scorecard Geral (IPV) -->
      <h3>
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        Ranking Geral de Performance (IPV)
      </h3>
      <p style="color: var(--text-gray); margin-bottom: 20px;">
        √çndice de Performance do Vendedor (0-100) baseado em Resultado (40%), Efici√™ncia (35%) e Comportamento (25%)
      </p>
      <table>
        <thead>
          <tr>
            <th>Rank</th>
            <th>Vendedor</th>
            <th>IPV (0-100)</th>
            <th>Resultado</th>
            <th>Efici√™ncia</th>
            <th>Comportamento</th>
            <th>Win Rate</th>
            <th>Gross Gerado</th>
          </tr>
        </thead>
        <tbody id="fsr-ipv-table"></tbody>
      </table>

      <h3 style="margin-top: 40px;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <path d="M9 9h6M9 15h6"/>
        </svg>
        Scorecard de Performance - Vendedores Ativos
      </h3>
      <table>
        <thead>
          <tr>
            <th>Vendedor</th>
            <th>Win Rate</th>
            <th>Total Ganhos</th>
            <th>Total Perdas</th>
            <th>Ciclo M√©dio (Win)</th>
            <th>Ciclo M√©dio (Loss)</th>
            <th>Ticket M√©dio (Gross)</th>
            <th>Gross Gerado</th>
            <th>Net Gerado</th>
          </tr>
        </thead>
        <tbody id="fsr-performance-active-body"></tbody>
      </table>

      <h3 style="margin-top: 40px;">Diagn√≥stico de Comportamento - Vendedores Ativos</h3>
      <table>
        <thead>
          <tr>
            <th>Vendedor</th>
            <th>Ativ. M√©dias (Win)</th>
            <th>Ativ. M√©dias (Loss)</th>
            <th>Principal Causa de Perda</th>
            <th>‚ú® Principal Fator de Sucesso</th>
          </tr>
        </thead>
        <tbody id="fsr-behavior-active-body"></tbody>
      </table>

      <details style="margin-top: 40px;">
        <summary style="cursor: pointer; color: var(--text-gray); font-weight: 600; padding: 10px; background: var(--card-bg); border-radius: 8px;">Vendedores Inativos (<span id="inactive-count">0</span>)</summary>
        <table style="margin-top: 20px;">
          <thead>
            <tr>
              <th>Vendedor</th>
              <th>Win Rate</th>
              <th>Total Ganhos</th>
              <th>Total Perdas</th>
              <th>Revenue Gerado</th>
            </tr>
          </thead>
          <tbody id="fsr-performance-inactive-body"></tbody>
        </table>
      </details>
    </div>

    <!-- SE√á√ÉO 4: POR VENDEDOR (NOVA - DRILL-DOWN) -->
    <div id="individual" class="section">
      <h3>Performance Individual por Vendedor</h3>
      <p style="color: var(--text-gray); margin-bottom: 20px;">Selecione um vendedor para ver detalhes completos</p>
      
      <div style="margin-bottom: 20px;">
        <select id="rep-selector" onchange="showRepDetails()" style="
          padding: 10px 15px; 
          background: var(--bg-card); 
          color: var(--text-white); 
          border: 1px solid rgba(255,255,255,0.1); 
          border-radius: 8px; 
          font-size: 14px;
          cursor: pointer;
          width: 100%;
          max-width: 400px;
        ">
          <option value="">-- Selecione um vendedor --</option>
        </select>
      </div>

      <div id="rep-details" style="display: none;">
        <h4 id="rep-name-title"></h4>
        
        <div class="kpi-grid">
          <div class="kpi-card">
            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M16 12l-4-4-4 4M12 16V8"/>
            </svg>
            <div class="kpi-title">Win Rate</div>
            <div class="kpi-value" id="rep-winrate">-</div>
          </div>
          <div class="kpi-card">
            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            <div class="kpi-title">Total Ganhos</div>
            <div class="kpi-value val-green" id="rep-wins">-</div>
          </div>
          <div class="kpi-card">
            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
            <div class="kpi-title">Total Perdas</div>
            <div class="kpi-value val-red" id="rep-losses">-</div>
          </div>
          <div class="kpi-card">
            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="1" x2="12" y2="23"/>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
            <div class="kpi-title">Revenue Gerado</div>
            <div class="kpi-value val-cyan" id="rep-revenue">-</div>
          </div>
          <div class="kpi-card">
            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12 6 12 12 16 14"/>
            </svg>
            <div class="kpi-title">Ciclo M√©dio (Win)</div>
            <div class="kpi-value val-green" id="rep-cycle-win">-</div>
          </div>
          <div class="kpi-card">
            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/>
              <polyline points="17 18 23 18 23 12"/>
            </svg>
            <div class="kpi-title">Ciclo M√©dio (Loss)</div>
            <div class="kpi-value val-red" id="rep-cycle-loss">-</div>
          </div>
          <div class="kpi-card">
            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <path d="M9 9h6M9 15h6"/>
            </svg>
            <div class="kpi-title">Ticket M√©dio</div>
            <div class="kpi-value val-cyan" id="rep-avg-ticket">-</div>
          </div>
          <div class="kpi-card">
            <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"/>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
            </svg>
            <div class="kpi-title">Atividades/Win</div>
            <div class="kpi-value" id="rep-activities-win">-</div>
          </div>
        </div>

        <h4 style="margin-top: 30px;">Diagn√≥stico Comportamental</h4>
        <div class="ai-card">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
              <div style="font-size: 12px; color: var(--text-gray); margin-bottom: 5px;">‚ú® Principal Fator de Sucesso</div>
              <div style="font-size: 14px; color: var(--success);" id="rep-win-factor">-</div>
            </div>
            <div>
              <div style="font-size: 12px; color: var(--text-gray); margin-bottom: 5px;">Principal Causa de Perda</div>
              <div style="font-size: 14px; color: var(--danger);" id="rep-loss-cause">-</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- SE√á√ÉO 5: PAUTA SEMANAL -->
    <div id="agenda" class="section">
      <h3>Oportunidades Cr√≠ticas em Pauta (Por Quarter)</h3>
      <div id="agenda-container">
        <div class="loading">Carregando pautas...</div>
      </div>
    </div>

    <!-- SE√á√ÉO 6: INTELIG√äNCIA ML -->
    <div id="ml" class="section">
      <h3>ü§ñ Intelig√™ncia Artificial: 6 Modelos Preditivos</h3>
      
      <!-- TABS ML -->
      <div style="display: flex; gap: 8px; margin-bottom: 20px; border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 0; flex-wrap: wrap;">
        <button class="ml-tab active" data-tab="previsao-ciclo" onclick="switchMLTab('previsao-ciclo')" style="
          background: none; 
          border: none; 
          color: var(--text-gray); 
          padding: 10px 16px; 
          cursor: pointer; 
          font-weight: 600; 
          font-size: 13px;
          border-bottom: 3px solid transparent;
          transition: all 0.3s;
        ">
          ‚è±Ô∏è Previs√£o de Ciclo
        </button>
        <button class="ml-tab" data-tab="classificador-perda" onclick="switchMLTab('classificador-perda')" style="
          background: none; 
          border: none; 
          color: var(--text-gray); 
          padding: 10px 16px; 
          cursor: pointer; 
          font-weight: 600; 
          font-size: 13px;
          border-bottom: 3px solid transparent;
          transition: all 0.3s;
        ">
          ‚ùå Classificador de Perda
        </button>
        <button class="ml-tab" data-tab="risco-abandono" onclick="switchMLTab('risco-abandono')" style="
          background: none; 
          border: none; 
          color: var(--text-gray); 
          padding: 10px 16px; 
          cursor: pointer; 
          font-weight: 600; 
          font-size: 13px;
          border-bottom: 3px solid transparent;
          transition: all 0.3s;
        ">
          üö® Risco de Abandono
        </button>
        <button class="ml-tab" data-tab="performance-vendedor" onclick="switchMLTab('performance-vendedor')" style="
          background: none; 
          border: none; 
          color: var(--text-gray); 
          padding: 10px 16px; 
          cursor: pointer; 
          font-weight: 600; 
          font-size: 13px;
          border-bottom: 3px solid transparent;
          transition: all 0.3s;
        ">
          üë§ Performance Vendedor
        </button>
        <button class="ml-tab" data-tab="prioridade-deals" onclick="switchMLTab('prioridade-deals')" style="
          background: none; 
          border: none; 
          color: var(--text-gray); 
          padding: 10px 16px; 
          cursor: pointer; 
          font-weight: 600; 
          font-size: 13px;
          border-bottom: 3px solid transparent;
          transition: all 0.3s;
        ">
          ‚≠ê Prioridade de Deals
        </button>
        <button class="ml-tab" data-tab="proxima-acao" onclick="switchMLTab('proxima-acao')" style="
          background: none; 
          border: none; 
          color: var(--text-gray); 
          padding: 10px 16px; 
          cursor: pointer; 
          font-weight: 600; 
          font-size: 13px;
          border-bottom: 3px solid transparent;
          transition: all 0.3s;
        ">
          üí° Pr√≥xima A√ß√£o
        </button>
      </div>

      <!-- CONTE√öDO DAS TABS -->
      <div id="ml-content-area">
        <div class="loading">ü§ñ Carregando predi√ß√µes de Machine Learning...</div>
      </div>
    </div>
  </div>

  <script>
    // Fun√ß√£o de log (wrapper para console.log)
    const log = (...args) => console.log(...args);
    
    // Recupera dados do servidor (n√£o mais injetados pelo template)
    let DATA = {
      l10: {},
      executive: {},
      fsrScorecard: [],
      fsrMetrics: {},
      insights: { topWinFactors: [], topLossCauses: [] },
      aiAnalysis: {},
      weeklyAgenda: {},
      updatedAt: new Date().toISOString(),
      quarterLabel: 'N/A'
    };
    
    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', () => {
      
      // Busca dados do servidor via Google Apps Script
      google.script.run
        .withSuccessHandler(function(jsonString) {
          try {
            log('[DASHBOARD] ========== IN√çCIO DO CARREGAMENTO ==========');
            log('[DATA] JSON recebido (tamanho):', jsonString.length, 'bytes');
            DATA = JSON.parse(jsonString);
            
            // Informa√ß√µes de cache
            const cacheAge = DATA.updatedAt ? Math.floor((new Date() - new Date(DATA.updatedAt)) / 60000) : 0;
            const cacheStatus = cacheAge < 5 ? '‚úÖ ATUAL' : cacheAge < 10 ? '‚ö†Ô∏è PODE ESTAR DESATUALIZADO' : '‚ùå DESATUALIZADO';
            console.log(`üì¶ Cache: ${cacheStatus} (${cacheAge} minutos, TTL: 5min)`);
            console.log(`üïê √öltima atualiza√ß√£o: ${DATA.updatedAt}`);
            
            log('[DATA] Estrutura de dados carregada:', {
              'weeklyAgenda quarters': Object.keys(DATA.weeklyAgenda || {}).length,
              'fsrScorecard vendedores': (DATA.fsrScorecard || []).length,
              'l10 keys': Object.keys(DATA.l10 || {}).length,
              'insights winFactors': (DATA.insights?.topWinFactors || []).length,
              'insights lossCauses': (DATA.insights?.topLossCauses || []).length,
              'aiAnalysis keys': Object.keys(DATA.aiAnalysis || {}).length,
              'wordClouds': DATA.wordClouds ? Object.keys(DATA.wordClouds).map(k => `${k}:${DATA.wordClouds[k].length}`).join(', ') : 'N/A',
              'quarterLabel': DATA.quarterLabel,
              'updatedAt': DATA.updatedAt,
              'cacheAge': `${cacheAge} min`
            });
            
            // Debug detalhado de insights
            if (DATA.insights) {
              log('[DEBUG] Insights completo:', DATA.insights);
              if (DATA.insights.topWinFactors) {
                log('[DEBUG] Top 3 Win Factors:', DATA.insights.topWinFactors.slice(0, 3));
              }
              if (DATA.insights.topLossCauses) {
                log('[DEBUG] Top 3 Loss Causes:', DATA.insights.topLossCauses.slice(0, 3));
              }
            }
            
            log('[DATA] Dados completos:', DATA);
            renderDashboard();
          } catch(e) {
            console.error('[ERROR] Erro ao parsear dados:', e);
            showError('Erro ao carregar dados: ' + e.message);
          }
        })
        .withFailureHandler(function(error) {
          console.error('‚ùå Erro ao buscar dados:', error);
          showError('Erro ao buscar dados do servidor: ' + error.message);
        })
        .getDashboardDataFromCache();
    });
    
    function showError(message) {
      document.body.innerHTML = `
        <div style="padding: 40px; text-align: center; color: #fff; background: #1c2b3e; min-height: 100vh;">
          <h2 style="color: #E14849;">‚ö†Ô∏è Erro ao carregar dashboard</h2>
          <p style="color: #b0b8c4; margin: 20px 0;">${message}</p>
          <button onclick="location.reload()" style="
            background: #00BEFF; 
            color: #1c2b3e; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            font-weight: 600; 
            cursor: pointer;
            font-size: 14px;
          ">Tentar Novamente</button>
        </div>
      `;
    }
    
    // Fun√ß√£o para limpar cache (chamada pelo bot√£o)
    function clearDashboardCache() {
      console.log('üîÑ Limpando cache e recarregando...');
      const btn = document.querySelector('.refresh-btn');
      if (btn) {
        btn.style.animation = 'spin 1s linear infinite';
        btn.disabled = true;
      }
      
      google.script.run
        .withSuccessHandler(function() {
          console.log('‚úÖ Cache limpo com sucesso!');
          setTimeout(() => location.reload(), 500);
        })
        .withFailureHandler(function(error) {
          console.error('‚ùå Erro ao limpar cache:', error);
          alert('Erro ao limpar cache. Recarregando p√°gina mesmo assim...');
          setTimeout(() => location.reload(), 500);
        })
        .clearCache();
    }

    // Fun√ß√£o para mostrar tempo desde √∫ltima atualiza√ß√£o
    function updateTimeSinceUpdate() {
      if (!DATA || !DATA.updatedAt) return;
      
      const updateTime = new Date(DATA.updatedAt);
      const now = new Date();
      const diffMs = now - updateTime;
      const diffMins = Math.floor(diffMs / 60000);
      
      const updateElement = document.getElementById('last-update');
      if (updateElement) {
        let timeText = '';
        let color = '#10b981'; // green
        
        if (diffMins < 1) {
          timeText = 'agora mesmo';
        } else if (diffMins === 1) {
          timeText = 'h√° 1 minuto';
        } else if (diffMins < 5) {
          timeText = `h√° ${diffMins} minutos`;
        } else {
          timeText = `h√° ${diffMins} minutos`;
          color = '#f59e0b'; // orange - cache pode estar desatualizado
        }
        
        updateElement.textContent = timeText;
        updateElement.style.color = color;
        updateElement.style.fontWeight = '600';
      }
    }
    
    // Atualiza o tempo a cada 30 segundos
    setInterval(updateTimeSinceUpdate, 30000);

    // Helper para formata√ß√£o de dinheiro (movido para antes de renderDashboard)
    function formatMoney(val) {
      if (!val && val !== 0) return '$0';
      return '$' + Math.round(val).toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0});
    }

    // Helper para formatar data e hora (movido para escopo global)
    const formatDateTime = (isoString) => {
      if (!isoString || isoString === '-') return '-';
      try {
        const date = new Date(isoString);
        const dateStr = date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
        const timeStr = date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        return `${dateStr} √†s ${timeStr}`;
      } catch (e) {
        return isoString;
      }
    };

    // Helper functions para manipula√ß√£o segura do DOM (movido para escopo global)
    const setTextSafe = (id, value) => {
      const el = document.getElementById(id);
      if (el) el.innerText = value;
      else console.warn(`Elemento n√£o encontrado: ${id}`);
    };

    const setHtmlSafe = (id, value) => {
      const el = document.getElementById(id);
      if (el) el.innerHTML = value;
      else console.warn(`Elemento n√£o encontrado: ${id}`);
    };

    const setBarSafe = (id, width, text) => {
      const el = document.getElementById(id);
      if (el) {
        el.style.width = width + '%';
        el.innerText = text;
      } else {
        console.warn(`Elemento de barra n√£o encontrado: ${id}`);
      }
    };

    // Helper para valores seguros (movido para escopo global)
    const safe = (obj, path, defaultVal = 0) => {
      const keys = path.split('.');
      let current = obj;
      for (const key of keys) {
        if (current && current[key] !== undefined) {
          current = current[key];
        } else {
          return defaultVal;
        }
      }
      return current;
    };

    // Helper para limpar poss√≠veis JSONs da IA
    const cleanAIResponse = (text) => {
      if (!text || typeof text !== 'string') return text;
      
      let cleaned = text.trim();
      
      // Se come√ßa com { e termina com }, tenta extrair JSON
      if (cleaned.startsWith('{') && cleaned.endsWith('}')) {
        try {
          // Tenta fazer parse do JSON
          const parsed = JSON.parse(cleaned);
          
          // Se √© um objeto simples com 1 campo, pega o valor
          const keys = Object.keys(parsed);
          if (keys.length === 1) {
            cleaned = parsed[keys[0]];
            log(`‚úÇÔ∏è Frontend: JSON extra√≠do da chave "${keys[0]}"`);
          } else {
            // Se tem m√∫ltiplas chaves, tenta pegar campos comuns
            cleaned = parsed.resumo_executivo || 
                      parsed.paragrafo_executivo || 
                      parsed.summary_html || 
                      parsed.resumo_semanal_html ||
                      parsed.resumo_semanal_cro ||
                      parsed.html || 
                      parsed.content || 
                      parsed.texto ||
                      cleaned;
            log(`‚úÇÔ∏è Frontend: JSON extra√≠do de objeto com ${keys.length} campos`);
          }
        } catch (e) {
          log(`‚ö†Ô∏è Frontend: JSON malformado, usando regex: ${e.message}`);
        }
      }
      
      // Aplica limpeza m√∫ltiplas vezes para garantir remo√ß√£o completa (fallback)
      for (let i = 0; i < 3; i++) {
        // { "campo": "valor" } -> valor (padr√£o completo)
        cleaned = cleaned.replace(/^\s*\{\s*"[^"]+"\s*:\s*"([^"]*)"\s*\}\s*$/s, '$1');
        
        // { "campo": "valor... -> valor...
        cleaned = cleaned.replace(/^\s*\{\s*"[^"]+"\s*:\s*"/, '');
        
        // ..." } -> ...
        cleaned = cleaned.replace(/"\s*\}\s*$/, '');
        
        // { "campo": (sem aspas no valor)
        cleaned = cleaned.replace(/^\s*\{\s*"[^"]+"\s*:\s*/, '');
        
        // } no final
        cleaned = cleaned.replace(/\s*\}\s*$/, '');
      }
      
      // Remove escapes e converte quebras
      cleaned = cleaned.replace(/\\n/g, '\n');
      cleaned = cleaned.replace(/\\"/g, '"');
      cleaned = cleaned.replace(/\\'/g, "'");
      cleaned = cleaned.replace(/\n/g, '<br>');
      
      return cleaned.trim();
    };

    function renderDashboard() {
      try {
        log('[RENDER] ========== IN√çCIO DA RENDERIZA√á√ÉO ==========');
        log('[RENDER] Timestamp:', new Date().toISOString());
        
        // ============================================================================
        // M√âTRICAS EST√ÅTICAS DESATIVADAS (sem fallback)
        // ============================================================================
        log('[RENDER] === M√âTRICAS EST√ÅTICAS DESATIVADAS ===');
        window.STATIC_METRICS_LOADED = false;
        window.STATIC_METRICS = null;

        // Header
        log('[RENDER] === HEADER ===');
        log('[DATA] updatedAt:', safe(DATA, 'updatedAt', '-'));
        log('[DATA] quarterLabel:', safe(DATA, 'quarterLabel', 'FY26'));
        setTextSafe('last-update', formatDateTime(safe(DATA, 'updatedAt', '-')));
        setTextSafe('quarter-label', safe(DATA, 'quarterLabel', 'FY26'));
        // Removido: quarter-label-exec (elemento foi removido do HTML)
        
        // Atualiza indicador de tempo desde √∫ltima atualiza√ß√£o
        updateTimeSinceUpdate();

        // 0. VIS√ÉO EXECUTIVA - NOVA ESTRUTURA
        log('[RENDER] ========== VIS√ÉO EXECUTIVA ==========');
        
        // SE√á√ÉO 1: O PLACAR DO QUARTER
        log('[RENDER] === SE√á√ÉO 1: O PLACAR DO QUARTER ===');
        // Calcula m√©tricas do quarter a partir dos dados j√° carregados
        const scorecard = DATA.fsrScorecard || [];
        log('[DATA] fsrScorecard:', scorecard.length, 'vendedores');
        const activeReps = scorecard.filter(r => r.isActive);
        log('[CALC] Vendedores ativos:', activeReps.length, '/', scorecard.length);
        
        // Pipeline do quarter - USA DADOS DA VIS√ÉO EXECUTIVA (L10)
        const l10 = DATA.executive || DATA.l10 || {};
        const quarters = DATA.weeklyAgenda || {};
        log('[DATA] weeklyAgenda quarters:', Object.keys(quarters));
        log('[DATA] l10 dispon√≠vel:', !!DATA.l10);
        
        // IMPORTANTE: pipelineTotal usa TODOS os anos (allPipelineGross), n√£o apenas FY26
        // VIS√ÉO EXECUTIVA: L√™ de cloudAnalysis (Python/BigQuery)
        let pipelineTotal = safe(DATA, 'cloudAnalysis.pipeline_analysis.executive.pipeline_all.gross', 0);
        let pipelineTotalNet = safe(DATA, 'cloudAnalysis.pipeline_analysis.executive.pipeline_all.net', 0);
        let pipelineDeals = safe(DATA, 'cloudAnalysis.pipeline_analysis.executive.pipeline_all.deals_count', 0);
        let commitValue = 0;
        let upsideValue = 0;
        let pipelineValue = 0;
        let totalConfidence = 0; // Para calcular m√©dia ponderada
        let totalDealsProcessed = 0; // Contador correto de deals para m√©dia
        let above50Value = 0; // Soma de Gross >= 50%
        let above50Net = 0; // Soma de Net >= 50%
        let above50Count = 0; // Contagem de deals >= 50%
        const allDeals = []; // Para principais oportunidades
        
        // Armazena todos os deals com seus dados para recalcular por per√≠odo
        window.allDealsWithConfidence = [];
        
        // Recalcula forecast categories usando GROSS (n√£o weighted) e allDeals
        Object.values(quarters).forEach(deals => {
          if (deals && Array.isArray(deals)) {
            deals.forEach(d => {
              let conf = d.confidence || 0;
              // Se confian√ßa vem como n√∫mero inteiro (ex: 50 ao inv√©s de 0.5), divide por 100
              if (conf > 1) conf = conf / 100;
              const grossValue = d.val || 0; // Usa GROSS direto
              const netValue = d.net || 0; // NET do deal
              totalConfidence += conf;
              totalDealsProcessed++; // Incrementa contador de deals processados
              
              // Filtra deals >= 50% confian√ßa
              if (conf >= 0.50) {
                above50Value += grossValue;
                above50Net += netValue;
                above50Count++;
              }
              
              // Armazena deal completo para recalcular por filtro
              window.allDealsWithConfidence.push({
                gross: grossValue,
                net: netValue,
                confidence: conf,
                closeDate: d.closeDate || d.closed,
                stage: d.stage,
                fiscalQ: d.fiscalQ || d.fiscal_q || ''  // Armazena Fiscal Q para filtro
              });
              
              // Classifica por categoria de forecast (An√°lise IA)
              // COMMIT: ‚â•90%, UPSIDE: 50-89%, PIPELINE: <50%
              // Confian√ßa j√° est√° em decimal (0.0 a 1.0)
              if (conf >= 0.90) commitValue += grossValue;
              else if (conf >= 0.50) upsideValue += grossValue;
              else pipelineValue += grossValue;
              
              // Guarda deal para lista de principais
              allDeals.push(d);
            });
          }
        });
        
        // Fun√ß√£o global para recalcular sa√∫de do forecast por per√≠odo
        window.updateForecastHealth = function(period) {
          log('[FORECAST HEALTH] Iniciando atualiza√ß√£o para per√≠odo:', period);
          log('[FORECAST HEALTH] Total de deals armazenados:', window.allDealsWithConfidence ? window.allDealsWithConfidence.length : 0);
          
          let filteredCommit = 0;
          let filteredUpside = 0;
          let filteredPipeline = 0;
          
          if (period === 'all' || period === 'total') {
            // Usa todos os deals
            window.allDealsWithConfidence.forEach(d => {
              let conf = d.confidence || 0;
              if (conf > 1) conf = conf / 100;
              if (conf >= 0.90) filteredCommit += d.gross;
              else if (conf >= 0.50) filteredUpside += d.gross;
              else filteredPipeline += d.gross;
            });
          } else {
            // Filtra por quarter usando Fiscal Q (ex: "FY26-Q1")
            const targetQuarter = 'FY26-' + period.toUpperCase(); // Ex: "q1" -> "FY26-Q1"
            
            log('[FORECAST HEALTH] Filtrando para:', targetQuarter);
            
            window.allDealsWithConfidence.forEach(d => {
              // Usa fiscalQ se dispon√≠vel, sen√£o tenta pela data
              if (d.fiscalQ === targetQuarter) {
                let conf = d.confidence || 0;
                if (conf > 1) conf = conf / 100;
                if (conf >= 0.90) filteredCommit += d.gross;
                else if (conf >= 0.50) filteredUpside += d.gross;
                else filteredPipeline += d.gross;
              }
            });
          }
          
          const totalForecast = filteredCommit + filteredUpside + filteredPipeline;
          const commitPercent = totalForecast > 0 ? (filteredCommit / totalForecast) * 100 : 0;
          const upsidePercent = totalForecast > 0 ? (filteredUpside / totalForecast) * 100 : 0;
          const pipelinePercent = totalForecast > 0 ? (filteredPipeline / totalForecast) * 100 : 0;
          
          log('[FORECAST HEALTH] Valores calculados:', {
            'totalForecast': formatMoney(totalForecast),
            'commit': formatMoney(filteredCommit) + ' (' + Math.round(commitPercent) + '%)',
            'upside': formatMoney(filteredUpside) + ' (' + Math.round(upsidePercent) + '%)',
            'pipeline': formatMoney(filteredPipeline) + ' (' + Math.round(pipelinePercent) + '%)'
          });
          
          setBarSafe('forecast-commit-bar', commitPercent, commitPercent >= 15 ? 'COMMIT' : '');
          setBarSafe('forecast-upside-bar', upsidePercent, upsidePercent >= 15 ? 'UPSIDE' : '');
          setBarSafe('forecast-pipeline-bar', pipelinePercent, pipelinePercent >= 15 ? 'PIPELINE' : '');
          
          setTextSafe('forecast-commit-value', formatMoney(filteredCommit) + ' (' + Math.round(commitPercent) + '%)');
          setTextSafe('forecast-upside-value', formatMoney(filteredUpside) + ' (' + Math.round(upsidePercent) + '%)');
          setTextSafe('forecast-pipeline-value', formatMoney(filteredPipeline) + ' (' + Math.round(pipelinePercent) + '%)');
        };
        
        log('[CALC] Pipeline calculado:', {
          'total': formatMoney(pipelineTotal),
          'deals': pipelineDeals,
          'above50Value': formatMoney(above50Value),
          'above50Count': above50Count,
          'commitValue': formatMoney(commitValue),
          'upsideValue': formatMoney(upsideValue),
          'pipelineValue': formatMoney(pipelineValue),
          'allDeals': allDeals.length
        });
        
        // Previs√£o ponderada M√âDIA (busca da an√°lise de IA ou calcula como fallback)
        let confidenceFromAI = 0;
        if (DATA.aiAnalysis && DATA.aiAnalysis.forecastAnalysis) {
          // Tenta extrair a confian√ßa da an√°lise de IA
          const forecastMatch = DATA.aiAnalysis.forecastAnalysis.match(/Confian√ßa[^\d]*(\d+)%/i);
          if (forecastMatch) {
            confidenceFromAI = parseInt(forecastMatch[1]);
            log('[DATA] Confian√ßa extra√≠da da an√°lise de IA:', confidenceFromAI + '%');
          }
        }
        // avgConfidence: prioriza m√©dia REAL dos deals; usa IA apenas se n√£o houver deals
        const avgConfidenceCalc = totalDealsProcessed > 0 ? (totalConfidence / totalDealsProcessed) * 100 : 0;
        // Se m√©tricas est√°ticas foram carregadas, usa avgConfidence de l√°, sen√£o usa calculado
        let avgConfidence = avgConfidenceCalc > 0 ? avgConfidenceCalc : confidenceFromAI;
        if (window.STATIC_METRICS_LOADED && window.STATIC_METRICS) {
          avgConfidence = parseFloat(window.STATIC_METRICS.avgConfidence);
          log('[HYBRID] Usando confian√ßa m√©dia das m√©tricas est√°ticas:', avgConfidence + '%');
        }
        log('[CALC] Confian√ßa m√©dia final:', Math.round(avgConfidence) + '%', '(fonte:', avgConfidenceCalc > 0 ? 'calculado' : 'IA', ')- Deals processados:', totalDealsProcessed);
        const forecastAvgWeighted = pipelineTotal * (avgConfidence / 100);
        log('[CALC] Forecast ponderado:', formatMoney(forecastAvgWeighted));
        
        // Armazena globalmente para evitar reset ao filtrar
        window.avgConfidence = avgConfidence;
        
        // Total fechado no quarter (soma dos ganhos dos vendedores ativos - APENAS QUARTER ATUAL)
        const closedGross = activeReps.reduce((sum, r) => sum + (r.revenueGross || 0), 0);
        const closedNet = activeReps.reduce((sum, r) => sum + (r.revenue || 0), 0);
        const closedDeals = activeReps.reduce((sum, r) => sum + (r.totalWonQuarter || 0), 0);
        log('[CALC] Fechados no Quarter:', formatMoney(closedGross), '(Gross) |', formatMoney(closedNet), '(Net) | (', closedDeals, 'deals )');
        
        // Taxa de convers√£o do quarter (APENAS QUARTER ATUAL)
        const totalWins = activeReps.reduce((sum, r) => sum + (r.totalWonQuarter || 0), 0);
        const totalLosses = activeReps.reduce((sum, r) => sum + (r.totalLostQuarter || 0), 0);
        const totalDeals = totalWins + totalLosses;
        const conversionRate = totalDeals > 0 ? Math.round((totalWins / totalDeals) * 100) : 0;
        
        // CORRE√á√ÉO: Declara wonAgg e lostAgg a partir do objeto DATA
        const wonAgg = DATA.wonAgg || [];
        const lostAgg = DATA.lostAgg || [];
        log('[DATA] wonAgg dispon√≠vel:', wonAgg.length, 'deals');
        log('[DATA] lostAgg dispon√≠vel:', lostAgg.length, 'deals');
        
        // Armazena globalmente para outras fun√ß√µes (ex: updateConversionMetricsForPeriod)
        window.wonAgg = wonAgg;
        window.lostAgg = lostAgg;
        
        // GROSS e NET de Ganhas e Perdidas (quarter atual)
        let winsGross = 0;
        let winsNet = 0;
        let lossesGross = 0;
        let lossesNet = 0;
        
        // Soma GROSS/NET das ganhas do quarter atual
        wonAgg.forEach(item => {
          if (item.fiscalQ === currentQuarterLabel) {
            winsGross += item.gross || 0;
            winsNet += item.net || 0;
          }
        });
        
        // Soma GROSS/NET das perdidas do quarter atual
        lostAgg.forEach(item => {
          if (item.fiscalQ === currentQuarterLabel) {
            lossesGross += item.gross || 0;
            lossesNet += item.net || 0;
          }
        });
        
        log('[CALC] Convers√£o do Quarter:', conversionRate + '%', '(', totalWins, '/', totalDeals, 'deals )');
        log('[CALC] Ganhas - Gross:', formatMoney(winsGross), '| Net:', formatMoney(winsNet), '(', totalWins, 'deals)');
        log('[CALC] Perdidas - Gross:', formatMoney(lossesGross), '| Net:', formatMoney(lossesNet), '(', totalLosses, 'deals)');
        
        // Popula KPIs do Placar
        log('[RENDER] Populando KPIs do Placar...');
        
        // ============================================================================
        // ARQUITETURA H√çBRIDA: Usa m√©tricas est√°ticas SE dispon√≠veis, sen√£o fallback
        // ============================================================================
        
        let pipelineTotalAnoGross, pipelineTotalAnoNet, pipelineTotalAnoDeals;
        let pipelineSalesSpecGross, pipelineSalesSpecNet, pipelineSalesSpecDeals;
        let allPipelineGross, allPipelineNet, allPipelineDeals;
        
        if (window.STATIC_METRICS_LOADED && window.STATIC_METRICS) {
          // OP√á√ÉO A: Usa m√©tricas pr√©-calculadas da aba (mais r√°pido e confi√°vel)
          log('[HYBRID] ‚úÖ Usando m√©tricas EST√ÅTICAS da aba');
          const m = window.STATIC_METRICS;
          
          pipelineTotalAnoGross = m.fy26PipelineGross;
          pipelineTotalAnoNet = m.fy26PipelineNet;
          pipelineTotalAnoDeals = m.fy26PipelineDeals;
          
          pipelineSalesSpecGross = m.salesSpecGross;
          pipelineSalesSpecNet = m.salesSpecNet;
          pipelineSalesSpecDeals = m.salesSpecDeals;
          
          allPipelineGross = m.allPipelineGross;
          allPipelineNet = m.allPipelineNet;
          allPipelineDeals = m.allPipelineDeals;
          
        } else {
          // OP√á√ÉO B: Fallback para payload JSON (caso aba n√£o esteja dispon√≠vel)
          log('[HYBRID] ‚ö†Ô∏è Fallback: Usando m√©tricas do payload JSON');
          
          // VIS√ÉO EXECUTIVA: CloudAnalysis
          pipelineTotalAnoGross = safe(DATA, 'cloudAnalysis.pipeline_analysis.executive.pipeline_fy26.gross', 0);
          pipelineTotalAnoNet = safe(DATA, 'cloudAnalysis.pipeline_analysis.executive.pipeline_fy26.net', 0);
          pipelineTotalAnoDeals = safe(DATA, 'cloudAnalysis.pipeline_analysis.executive.pipeline_fy26.deals_count', 0);
          
          pipelineSalesSpecGross = safe(DATA, 'cloudAnalysis.closed_analysis.closed_quarter.forecast_specialist.gross', 0);
          pipelineSalesSpecNet = safe(DATA, 'cloudAnalysis.closed_analysis.closed_quarter.forecast_specialist.net', 0);
          pipelineSalesSpecDeals = safe(DATA, 'cloudAnalysis.closed_analysis.closed_quarter.forecast_specialist.deals_count', 0);
          
          allPipelineGross = safe(DATA, 'cloudAnalysis.pipeline_analysis.executive.pipeline_all.gross', pipelineTotalAnoGross);
          allPipelineNet = safe(DATA, 'cloudAnalysis.pipeline_analysis.executive.pipeline_all.net', pipelineTotalAnoNet);
          allPipelineDeals = safe(DATA, 'cloudAnalysis.pipeline_analysis.executive.pipeline_all.deals_count', pipelineTotalAnoDeals);
        }
        
        // Detecta FY atual baseado na data (extrai FY26 de "FY26-Q1")
        const currentFY = safe(DATA, 'quarterLabel', 'FY26-Q1').split('-')[0]; // Extrai "FY26" de "FY26-Q1"
        window.currentFY = currentFY;

        // Detalhamento por quarter (sempre do payload JSON - usado para filtros)
        // VIS√ÉO EXECUTIVA: Quarters de cloudAnalysis
        const qDetailsRaw = safe(DATA, 'cloudAnalysis.pipeline_analysis.executive.pipeline_by_quarter', {});
        
        // NOVOS KPIS: Pipeline Total Ano e Sales Specialist (usa valores h√≠bridos)
        
        log('[CALC] Pipeline FY26:', formatMoney(pipelineTotalAnoGross), '(', pipelineTotalAnoDeals, 'deals )');
        log('[CALC] Previs√£o Sales Specialist:', formatMoney(pipelineSalesSpecGross), '(', pipelineSalesSpecDeals, 'deals )');
        log('[CALC] Pipeline Total (Todos Anos):', formatMoney(allPipelineGross), '(', allPipelineDeals, 'deals )');
        
        // Atualiza labels dos filtros com formato completo FY26-Q1
        setTextSafe('filter-total-label', 'Todo Pipeline (' + currentFY + ')');
        setTextSafe('filter-q1-label', currentFY + '-Q1');
        setTextSafe('filter-q2-label', currentFY + '-Q2');
        setTextSafe('filter-q3-label', currentFY + '-Q3');
        setTextSafe('filter-q4-label', currentFY + '-Q4');
        
        // Normaliza quarters (suporta FY26-Q1 e Q1)
        const qDetails = {
          Q1: qDetailsRaw[currentFY + '-Q1'] || qDetailsRaw.Q1 || { gross: 0, net: 0, count: 0 },
          Q2: qDetailsRaw[currentFY + '-Q2'] || qDetailsRaw.Q2 || { gross: 0, net: 0, count: 0 },
          Q3: qDetailsRaw[currentFY + '-Q3'] || qDetailsRaw.Q3 || { gross: 0, net: 0, count: 0 },
          Q4: qDetailsRaw[currentFY + '-Q4'] || qDetailsRaw.Q4 || { gross: 0, net: 0, count: 0 }
        };

        // Inicializa com view total
        window.pipelineData = {
          all: { gross: allPipelineGross, net: allPipelineNet, count: allPipelineDeals },
          total: { gross: pipelineTotalAnoGross, net: pipelineTotalAnoNet, count: pipelineTotalAnoDeals },
          q1: qDetails.Q1 || { gross: 0, net: 0, count: 0 },
          q2: qDetails.Q2 || { gross: 0, net: 0, count: 0 },
          q3: qDetails.Q3 || { gross: 0, net: 0, count: 0 },
          q4: qDetails.Q4 || { gross: 0, net: 0, count: 0 }
        };

        // Dados Sales Specialist por Fiscal Q (baseado em Closed Date)
        // VIS√ÉO EXECUTIVA: Sales Specialist breakdown  
        const salesSpecCommitGross = safe(DATA, 'cloudAnalysis.closed_analysis.closed_quarter.forecast_specialist.commit_gross', 0);
        const salesSpecCommitNet = safe(DATA, 'cloudAnalysis.closed_analysis.closed_quarter.forecast_specialist.commit_net', 0);
        const salesSpecCommitDeals = safe(DATA, 'cloudAnalysis.closed_analysis.closed_quarter.forecast_specialist.commit_deals', 0);
        const salesSpecUpsideGross = safe(DATA, 'cloudAnalysis.closed_analysis.closed_quarter.forecast_specialist.upside_gross', 0);
        const salesSpecUpsideNet = safe(DATA, 'cloudAnalysis.closed_analysis.closed_quarter.forecast_specialist.upside_net', 0);
        const salesSpecUpsideDeals = safe(DATA, 'cloudAnalysis.closed_analysis.closed_quarter.forecast_specialist.upside_deals', 0);
        
        window.salesSpecData = {
          all: { gross: pipelineSalesSpecGross, net: pipelineSalesSpecNet, count: pipelineSalesSpecDeals },
          byFiscalQ: safe(DATA, 'cloudAnalysis.closed_analysis.closed_quarter.forecast_specialist.by_fiscal_q', {}),
          commitGross: salesSpecCommitGross,
          commitNet: salesSpecCommitNet,
          upsideGross: salesSpecUpsideGross,
          upsideNet: salesSpecUpsideNet
        };
        
        // ============================================================================
        // POPULA KPIs (usa m√©tricas est√°ticas se dispon√≠veis, sen√£o usa valores locais)
        // ============================================================================
        
        // SE m√©tricas est√°ticas N√ÉO foram carregadas ainda, popula com valores locais
        if (!window.STATIC_METRICS_LOADED) {
          log('[HYBRID] Populando KPIs com valores locais (m√©tricas est√°ticas ainda carregando...)');
          
          // Pipeline Total (TODOS OS ANOS) - EST√ÅTICO
          setTextSafe('exec-pipeline-year-total', formatMoney(allPipelineGross));
          setTextSafe('exec-pipeline-year-deals', allPipelineDeals + ' deals abertos');
          setTextSafe('exec-pipeline-year-net', 'Net: ' + formatMoney(allPipelineNet));

          // Pipeline (Per√≠odo Filtrado) - DIN√ÇMICO
          setTextSafe('exec-pipeline-total', formatMoney(allPipelineGross));
          setTextSafe('exec-pipeline-deals', allPipelineDeals + ' deals abertos');
          setTextSafe('exec-pipeline-net', 'Net: ' + formatMoney(allPipelineNet));
          
          // Sales Specialist
          setTextSafe('exec-pipeline-specialist-total', formatMoney(pipelineSalesSpecGross));
          setTextSafe('exec-pipeline-specialist-deals', pipelineSalesSpecDeals + ' deals curados');
          setTextSafe('exec-pipeline-specialist-net', 'Net: ' + formatMoney(pipelineSalesSpecNet));
        }
        
        // Vendedores Ativos e Win Rate (sempre popula)
        setTextSafe('exec-active-reps', activeReps.length);
        setTextSafe('exec-winrate', 'Win Rate: ' + conversionRate + '%');
        
        // Popula Net em outros cards
        // IMPORTANTE: Usa Net de TODOS os anos (allPipelineNet), mantendo consist√™ncia com pipelineTotal
        const correctPipelineNet = safe(DATA, 'cloudAnalysis.pipeline_analysis.executive.pipeline_all.net', pipelineTotalNet);  
        const forecastNetWeighted = correctPipelineNet * (avgConfidence / 100);
        setTextSafe('exec-forecast-net', 'Net: ' + formatMoney(forecastNetWeighted));
        setTextSafe('exec-above50-net', 'Net: ' + formatMoney(above50Net));
        
        // Inicializa filtro com per√≠odo total
        filterPipeline('all'); // Renderiza view inicial
        
        setTextSafe('exec-forecast-weighted', formatMoney(forecastAvgWeighted));
        setTextSafe('exec-forecast-percent', Math.round(avgConfidence) + '% confian√ßa m√©dia');
        setTextSafe('exec-above50-value', formatMoney(above50Value));
        setTextSafe('exec-above50-count', above50Count + ' deals');
        setTextSafe('exec-above50-net', 'Net: ' + formatMoney(above50Net));
        setTextSafe('exec-closed-total', formatMoney(winsGross));
        setTextSafe('exec-closed-deals', totalWins + ' deals ganhos');
        setTextSafe('exec-closed-net', 'Net: ' + formatMoney(winsNet));
        setTextSafe('exec-conversion-rate', conversionRate + '%');
        setTextSafe('exec-conversion-detail', totalWins + '/' + totalDeals + ' deals');
        
        // Armazena m√©tricas de ganhas/perdidas para uso global
        window.conversionMetrics = {
          winsGross,
          winsNet,
          lossesGross,
          lossesNet,
          totalWins,
          totalLosses,
          totalDeals,
          conversionRate
        };
        
        // Sa√∫de do Forecast (barra visual)
        // An√°lise IA: COMMIT ‚â•90%, UPSIDE 50-89%, PIPELINE <50%
        const totalForecast = commitValue + upsideValue + pipelineValue;
        const commitPercent = totalForecast > 0 ? (commitValue / totalForecast) * 100 : 0;
        const upsidePercent = totalForecast > 0 ? (upsideValue / totalForecast) * 100 : 0;
        const pipelinePercent = totalForecast > 0 ? (pipelineValue / totalForecast) * 100 : 0;
        log('[CALC] Forecast sa√∫de:', {
          'commit': Math.round(commitPercent) + '% (' + formatMoney(commitValue) + ')',
          'upside': Math.round(upsidePercent) + '% (' + formatMoney(upsideValue) + ')',
          'pipeline': Math.round(pipelinePercent) + '% (' + formatMoney(pipelineValue) + ')'
        });
        
        setBarSafe('forecast-commit-bar', commitPercent, commitPercent >= 15 ? 'COMMIT' : '');
        setBarSafe('forecast-upside-bar', upsidePercent, upsidePercent >= 15 ? 'UPSIDE' : '');
        setBarSafe('forecast-pipeline-bar', pipelinePercent, pipelinePercent >= 15 ? 'PIPELINE' : '');
        
        setTextSafe('forecast-commit-value', formatMoney(commitValue) + ' (' + Math.round(commitPercent) + '%)');
        setTextSafe('forecast-upside-value', formatMoney(upsideValue) + ' (' + Math.round(upsidePercent) + '%)');
        setTextSafe('forecast-pipeline-value', formatMoney(pipelineValue) + ' (' + Math.round(pipelinePercent) + '%)');
        
        // Sa√∫de do Forecast - Sales Specialist (usando dados do backend)
        const totalSalesSpec = salesSpecCommitGross + salesSpecUpsideGross;
        const ssCommitPercent = totalSalesSpec > 0 ? (salesSpecCommitGross / totalSalesSpec) * 100 : 0;
        const ssUpsidePercent = totalSalesSpec > 0 ? (salesSpecUpsideGross / totalSalesSpec) * 100 : 0;
        
        log('[CALC] Sales Specialist sa√∫de:', {
          'commit': Math.round(ssCommitPercent) + '% (' + formatMoney(salesSpecCommitGross) + ')',
          'upside': Math.round(ssUpsidePercent) + '% (' + formatMoney(salesSpecUpsideGross) + ')'
        });
        
        setBarSafe('forecast-ss-commit-bar', ssCommitPercent, ssCommitPercent >= 15 ? 'COMMIT' : '');
        setBarSafe('forecast-ss-upside-bar', ssUpsidePercent, ssUpsidePercent >= 15 ? 'UPSIDE' : '');
        
        setTextSafe('forecast-ss-commit-value', formatMoney(salesSpecCommitGross) + ' (' + Math.round(ssCommitPercent) + '%)');
        setTextSafe('forecast-ss-upside-value', formatMoney(salesSpecUpsideGross) + ' (' + Math.round(ssUpsidePercent) + '%)');
        
        // SE√á√ÉO 2: An√°lise Estrat√©gica da IA (j√° existe)
        const execContentEl = document.getElementById('executive-content');
        if (execContentEl) {
          if (DATA.aiAnalysis) {
            execContentEl.innerHTML = cleanAIResponse(safe(DATA, 'aiAnalysis.executive', '<i>Gerando an√°lise...</i>'));
          } else {
            execContentEl.innerHTML = '<i>An√°lise sendo processada...</i>';
          }
        }
        
        // SE√á√ÉO 3: DESTAQUES OPERACIONAIS DO QUARTER
        
        // Oportunidade-Chave #1 (maior valor aberto no quarter)
        let keyOpp = null;
        let maxValue = 0;
        Object.values(quarters).forEach(deals => {
          if (deals && Array.isArray(deals)) {
            deals.forEach(d => {
              if ((d.val || 0) > maxValue) {
                maxValue = d.val || 0;
                keyOpp = d;
              }
            });
          }
        });
        
        if (keyOpp) {
          setTextSafe('exec-key-opp-name', keyOpp.name || 'N/A');
          setTextSafe('exec-key-opp-value', formatMoney(keyOpp.val || 0));
          setTextSafe('exec-key-opp-owner', keyOpp.owner || 'N/A');
          setTextSafe('exec-key-opp-why', 'Maior valor em aberto (' + formatMoney(keyOpp.val || 0) + ')');
          
          const riskFactors = [];
          if ((keyOpp.confidence || 0) < 50) riskFactors.push('Baixa confian√ßa (' + (keyOpp.confidence || 0) + '%)');
          if ((keyOpp.daysToClose || 0) < 0) riskFactors.push('Atrasado');
          if (!keyOpp.nextActivity) riskFactors.push('Sem pr√≥xima atividade');
          
          setTextSafe('exec-key-opp-risk', riskFactors.length > 0 ? riskFactors.join(', ') : 'Nenhum risco cr√≠tico identificado');
        } else {
          setTextSafe('exec-key-opp-name', 'Nenhuma oportunidade aberta');
          setTextSafe('exec-key-opp-value', '$0');
          setTextSafe('exec-key-opp-owner', '-');
          setTextSafe('exec-key-opp-why', '-');
          setTextSafe('exec-key-opp-risk', '-');
        }
        
        // Vit√≥ria Destaque (maior valor ganho - simula baseado no maior revenue de vendedor)
        let topWinRep = null;
        let maxRevenue = 0;
        activeReps.forEach(rep => {
          if ((rep.revenue || 0) > maxRevenue && (rep.totalWon || 0) > 0) {
            maxRevenue = rep.revenue || 0;
            topWinRep = rep;
          }
        });
        
        if (topWinRep) {
          setTextSafe('exec-top-win-name', 'Portf√≥lio de ' + topWinRep.name);
          setTextSafe('exec-top-win-value', formatMoney(topWinRep.revenue));
          setTextSafe('exec-top-win-owner', topWinRep.name);
          
          const winReasons = [];
          if ((topWinRep.winRate || 0) >= 80) winReasons.push('Excelente win rate (' + topWinRep.winRate + '%)');
          if ((topWinRep.avgWinCycle || 0) < 90) winReasons.push('Ciclo r√°pido (' + topWinRep.avgWinCycle + ' dias)');
          if (topWinRep.topWinFactor && topWinRep.topWinFactor !== 'N/A') winReasons.push(topWinRep.topWinFactor);
          
          setTextSafe('exec-top-win-why', winReasons.length > 0 ? winReasons.join('. ') : 'Maior revenue gerado no quarter');
        } else {
          setTextSafe('exec-top-win-name', 'Nenhuma vit√≥ria registrada');
          setTextSafe('exec-top-win-value', '$0');
          setTextSafe('exec-top-win-owner', '-');
          setTextSafe('exec-top-win-why', '-');
        }
        
        // Perda Destaque (vendedor com mais perdas ou maior ciclo de perda)
        let topLossRep = null;
        let maxLosses = 0;
        activeReps.forEach(rep => {
          if ((rep.totalLost || 0) > maxLosses) {
            maxLosses = rep.totalLost || 0;
            topLossRep = rep;
          }
        });
        
        if (topLossRep && maxLosses > 0) {
          const avgLossValue = topLossRep.revenue > 0 && topLossRep.totalWon > 0 ? topLossRep.revenue / topLossRep.totalWon : 50000;
          const estimatedLossValue = maxLosses * avgLossValue;
          
          setTextSafe('exec-top-loss-name', 'Oportunidades de ' + topLossRep.name);
          setTextSafe('exec-top-loss-value', formatMoney(estimatedLossValue) + ' (est.)');
          setTextSafe('exec-top-loss-owner', topLossRep.name);
          
          const lossReasons = [];
          if (topLossRep.topLossCause && topLossRep.topLossCause !== 'N/A') lossReasons.push(topLossRep.topLossCause);
          if ((topLossRep.avgLossCycle || 0) > 180) lossReasons.push('Ciclo de perda muito longo (' + topLossRep.avgLossCycle + ' dias)');
          lossReasons.push(maxLosses + ' deals perdidos');
          
          setTextSafe('exec-top-loss-why', lossReasons.join('. '));
        } else {
          setTextSafe('exec-top-loss-name', 'Nenhuma perda significativa');
          setTextSafe('exec-top-loss-value', '$0');
          setTextSafe('exec-top-loss-owner', '-');
          setTextSafe('exec-top-loss-why', '-');
        }
        
        // SE√á√ÉO 4: DESTAQUES DA EQUIPE NO QUARTER
        
        // MVP do Quarter (melhor win rate + revenue)
        let mvp = null;
        let mvpScore = 0;
        activeReps.forEach(rep => {
          if ((rep.totalWon || 0) >= 3) { // M√≠nimo de 3 ganhos para qualificar
            // Score: win rate * revenue (normalizado)
            const score = ((rep.winRate || 0) / 100) * (rep.revenue || 0);
            if (score > mvpScore) {
              mvpScore = score;
              mvp = rep;
            }
          }
        });
        
        if (mvp) {
          const initial = mvp.name ? mvp.name.charAt(0).toUpperCase() : '?';
          setTextSafe('exec-mvp-initial', initial);
          setTextSafe('exec-mvp-name', mvp.name);
          
          const mvpReason = `Liderando com ${mvp.winRate}% de Win Rate e ${formatMoney(mvp.revenue)} em revenue. ` +
                           `Ciclo de vendas de ${mvp.avgWinCycle} dias (${mvp.totalWon} vit√≥rias).`;
          setTextSafe('exec-mvp-reason', mvpReason);
        } else {
          setTextSafe('exec-mvp-initial', '-');
          setTextSafe('exec-mvp-name', 'Dados insuficientes');
          setTextSafe('exec-mvp-reason', 'Nenhum vendedor com m√≠nimo de 3 ganhos no quarter');
        }
        
        // Ponto de Aten√ß√£o (pior win rate ou ciclo de perda muito longo)
        let attention = null;
        let worstScore = 100;
        activeReps.forEach(rep => {
          if ((rep.totalWon || 0) + (rep.totalLost || 0) >= 5) { // M√≠nimo de 5 deals para qualificar
            const score = rep.winRate || 0;
            if (score < worstScore) {
              worstScore = score;
              attention = rep;
            }
          }
        });
        
        if (attention && worstScore < 50) {
          const initial = attention.name ? attention.name.charAt(0).toUpperCase() : '?';
          setTextSafe('exec-attention-initial', initial);
          setTextSafe('exec-attention-name', attention.name);
          
          const reasons = [];
          if ((attention.winRate || 0) < 40) reasons.push(`Win rate de apenas ${attention.winRate}%`);
          if ((attention.avgLossCycle || 0) > 200) reasons.push(`Ciclo de perda de ${attention.avgLossCycle} dias`);
          if (attention.topLossCause && attention.topLossCause !== 'N/A') reasons.push(`Principal causa: ${attention.topLossCause}`);
          
          const attentionReason = reasons.length > 0 ? reasons.join('. ') + '.' : `Requer aten√ß√£o devido ao desempenho abaixo da m√©dia (${attention.winRate}% win rate).`;
          setTextSafe('exec-attention-reason', attentionReason);
        } else {
          setTextSafe('exec-attention-initial', '‚úì');
          setTextSafe('exec-attention-name', 'Equipe performando bem');
          setTextSafe('exec-attention-reason', 'Nenhum ponto cr√≠tico de aten√ß√£o identificado no momento');
        }

        // SE√á√ÉO 5: TOP 5 OPORTUNIDADES DO QUARTER
        log('[RENDER] === SE√á√ÉO 5: TOP 5 OPORTUNIDADES ===');
        // Popula an√°lise de IA das oportunidades
        const topOppsAIEl = document.getElementById('exec-top-opps-ai-analysis');
        if (topOppsAIEl) {
          if (DATA.aiAnalysis && DATA.aiAnalysis.topOpportunitiesAnalysis) {
            topOppsAIEl.innerHTML = DATA.aiAnalysis.topOpportunitiesAnalysis;
          } else {
            topOppsAIEl.innerHTML = '<p style="color: var(--text-gray);">An√°lise de oportunidades ser√° gerada na pr√≥xima atualiza√ß√£o.</p>';
          }
        }
        
        const topOppsContainer = document.getElementById('exec-top-opps-container');
        if (topOppsContainer) {
          topOppsContainer.innerHTML = '';
        
        // FILTRO POR QUARTER ATUAL: Pega apenas deals do quarter corrente (ex: FY26-Q1)
        const currentQuarterLabel = DATA.quarterLabel || 'FY26-Q1';
        const dealsCurrentQuarter = allDeals.filter(d => d.fiscalQ === currentQuarterLabel || d.quarter === currentQuarterLabel);
        
        log('[FILTER] Quarter atual:', currentQuarterLabel);
        log('[FILTER] Total deals:', allDeals.length, '‚Üí Filtrados do quarter:', dealsCurrentQuarter.length);
        
        // Ordena deals do quarter atual por valor e pega top 5
        const top5Deals = dealsCurrentQuarter
          .sort((a, b) => (b.val || 0) - (a.val || 0))
          .slice(0, 5);
        
        log('[DATA] Top 5 deals encontrados:', top5Deals.length);
        top5Deals.forEach((d, i) => {
          log(`[DATA] Deal #${i+1}:`, {
            'name': d.name,
            'account': d.account || d.accountName,
            'value': formatMoney(d.val),
            'confidence': (d.confidence || 0) + '%',
            'owner': d.owner,
            'stage': d.stage,
            'quarter': d.quarter,
            'hasAuditQuestions': !!(d.auditQuestions),
            'hasPipelineAnalysis': !!(d.pipelineAnalysis || d.insight),
            'hasFlags': !!(d.flags)
          });
        });
        
        // Calcula indicadores do Top 5 (baseado no quarter atual)
        const top5Total = top5Deals.reduce((sum, d) => sum + (d.val || 0), 0);
        const pipelineQuarterTotal = dealsCurrentQuarter.reduce((sum, d) => sum + (d.val || 0), 0);
        const top5Percent = pipelineQuarterTotal > 0 ? ((top5Total / pipelineQuarterTotal) * 100).toFixed(1) : 0;
        const top5AvgConf = top5Deals.length > 0 
          ? Math.round(top5Deals.reduce((sum, d) => sum + (d.confidence || 0), 0) / top5Deals.length)
          : 0;
        
        setTextSafe('exec-top5-total', formatMoney(top5Total));
        setTextSafe('exec-top5-percent', top5Percent + '% do pipeline do quarter (' + currentQuarterLabel + ')');
        setTextSafe('exec-top5-confidence', top5AvgConf + '%');
        
        if (top5Deals.length > 0) {
          top5Deals.forEach((deal, idx) => {
            const conf = deal.confidence || 0;
            let confBadge = 'badge-warning';
            if (conf >= 90) confBadge = 'badge-success';
            else if (conf < 50) confBadge = 'badge-danger';
            
            const card = document.createElement('div');
            card.className = 'deal-card';
            card.style.marginBottom = '10px';
            
            // Nome da conta
            const accountName = deal.account || deal.accountName || 'Conta n√£o informada';
            
            // Busca insight individual da an√°lise de pipeline
            const dealInsight = deal.pipelineAnalysis || deal.insight || '';
            
            // Extrai perguntas de auditoria se existirem
            const auditQuestions = deal.auditQuestions || '';
            const questionsArray = auditQuestions.split('|').map(q => q.trim()).filter(q => q.length > 0);
            
            card.innerHTML = `
              <div style="font-size: 10px; color: var(--text-gray); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">#${idx + 1} ¬∑ ${deal.quarter || 'Quarter N/A'}</div>
              <div class="deal-header">
                <div>
                  <div class="deal-name">${deal.name || 'Deal sem nome'}</div>
                  <div style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 12px; height: 12px; vertical-align: middle; margin-right: 4px;">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                      <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Conta: <strong style="color: var(--text-white);">${deal.account || deal.accountName || 'N/A'}</strong>
                  </div>
                </div>
                <div class="deal-value">${formatMoney(deal.val || 0)}</div>
              </div>
              <div class="deal-meta" style="margin-top: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <span><strong>Respons√°vel:</strong> ${deal.owner || 'N/A'}</span>
                  <span class="badge ${confBadge}">${conf}% confian√ßa</span>
                </div>
                ${deal.stage ? `<div style="margin-top: 8px; font-size: 12px; color: var(--text-gray);"><strong>Stage:</strong> ${deal.stage}</div>` : ''}
                ${questionsArray.length > 0 ? `
                  <details style="margin-top: 12px; padding: 12px; background: rgba(225,72,73,0.1); border-left: 3px solid var(--danger); border-radius: 4px;">
                    <summary style="cursor: pointer; font-weight: 600; color: var(--danger); font-size: 13px; user-select: none;">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                      </svg>
                      Perguntas de Auditoria IA
                    </summary>
                    <ul style="margin: 12px 0 0 0; padding-left: 20px; font-size: 12px; line-height: 1.7; color: var(--text-gray);">
                      ${questionsArray.map(q => `<li style="margin-bottom: 8px;">${q}</li>`).join('')}
                    </ul>
                  </details>
                ` : ''}
                ${dealInsight ? `
                  <details style="margin-top: 12px; padding: 10px; background: rgba(0,190,255,0.05); border-left: 3px solid var(--primary-cyan); border-radius: 4px;">
                    <summary style="cursor: pointer; font-weight: 600; color: var(--primary-cyan); font-size: 12px; user-select: none;">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                      </svg>
                      Insights da An√°lise de Pipeline
                    </summary>
                    <div style="margin-top: 10px; font-size: 12px; line-height: 1.6; color: var(--text-gray);">
                      ${dealInsight}
                    </div>
                  </details>
                ` : ''}
              </div>
            `;
            topOppsContainer.appendChild(card);
          });
        } else {
          topOppsContainer.innerHTML = '<div style="color: var(--text-gray); padding: 20px; text-align: center;">Nenhuma oportunidade encontrada no pipeline</div>';
        }
        } // fim do if topOppsContainer

        // ============================================================================
        // FUN√á√ÉO GLOBAL: Atualiza Top 5 Oportunidades por per√≠odo
        // ============================================================================
        window.updateTop5Opps = function(period) {
          log('[TOP 5] ========== ATUALIZANDO TOP 5 PARA PER√çODO:', period, '==========');
          
          if (!window.allDealsWithQuarter) {
            log('[TOP 5] ‚ö†Ô∏è allDealsWithQuarter n√£o dispon√≠vel');
            return;
          }
          
          const fy = window.currentFY || 'FY26';
          let filteredDeals = [];
          
          // Filtra deals por per√≠odo
          if (period === 'q1' || period === 'q2' || period === 'q3' || period === 'q4') {
            const targetQuarter = `${fy}-${period.toUpperCase()}`; // Ex: "FY26-Q1"
            filteredDeals = window.allDealsWithQuarter.filter(d => d.fiscalQ === targetQuarter);
            log('[TOP 5] Filtrando para quarter:', targetQuarter, '‚Üí', filteredDeals.length, 'deals');
          } else {
            // 'all' ou 'total': mostra todos os deals
            filteredDeals = window.allDealsWithQuarter;
            log('[TOP 5] Mostrando TODOS os deals:', filteredDeals.length);
          }
          
          // Ordena por valor e pega top 5
          const top5 = filteredDeals
            .sort((a, b) => (b.val || 0) - (a.val || 0))
            .slice(0, 5);
          
          log('[TOP 5] Top 5 selecionados:', top5.length);
          
          // Calcula m√©tricas
          const top5Total = top5.reduce((sum, d) => sum + (d.val || 0), 0);
          const pipelineTotal = filteredDeals.reduce((sum, d) => sum + (d.val || 0), 0);
          const top5Percent = pipelineTotal > 0 ? ((top5Total / pipelineTotal) * 100).toFixed(1) : 0;
          const top5AvgConf = top5.length > 0 
            ? Math.round(top5.reduce((sum, d) => sum + (d.confidence || 0), 0) / top5.length)
            : 0;
          
          // Atualiza indicadores
          setTextSafe('exec-top5-total', formatMoney(top5Total));
          
          let periodLabel = period === 'total' ? fy : 
                           period === 'all' ? 'Todos os Anos' :
                           `${fy}-${period.toUpperCase()}`;
          setTextSafe('exec-top5-percent', top5Percent + '% do pipeline (' + periodLabel + ')');
          setTextSafe('exec-top5-confidence', top5AvgConf + '%');
          
          // Renderiza cards
          const container = document.getElementById('exec-top-opps-container');
          if (!container) return;
          
          container.innerHTML = '';
          
          if (top5.length === 0) {
            container.innerHTML = '<div style="color: var(--text-gray); padding: 20px; text-align: center;">Nenhuma oportunidade encontrada no per√≠odo selecionado</div>';
            return;
          }
          
          top5.forEach((deal, idx) => {
            const conf = deal.confidence || 0;
            let confBadge = 'badge-warning';
            if (conf >= 90) confBadge = 'badge-success';
            else if (conf < 50) confBadge = 'badge-danger';
            
            const card = document.createElement('div');
            card.className = 'deal-card';
            card.style.marginBottom = '10px';
            
            const accountName = deal.account || deal.accountName || 'Conta n√£o informada';
            const dealInsight = deal.pipelineAnalysis || deal.insight || '';
            const auditQuestions = deal.auditQuestions || '';
            const questionsArray = auditQuestions.split('|').map(q => q.trim()).filter(q => q.length > 0);
            
            card.innerHTML = `
              <div style="font-size: 10px; color: var(--text-gray); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">#${idx + 1} ¬∑ ${deal.fiscalQ || 'Quarter N/A'}</div>
              <div class="deal-header">
                <div>
                  <div class="deal-name">${deal.name || 'Deal sem nome'}</div>
                  <div style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 12px; height: 12px; vertical-align: middle; margin-right: 4px;">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                      <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Conta: <strong style="color: var(--text-white);">${accountName}</strong>
                  </div>
                </div>
                <div class="deal-value">${formatMoney(deal.val || 0)}</div>
              </div>
              <div class="deal-meta" style="margin-top: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <span><strong>Respons√°vel:</strong> ${deal.owner || 'N/A'}</span>
                  <span class="badge ${confBadge}">${conf}% confian√ßa</span>
                </div>
                ${deal.stage ? `<div style="margin-top: 8px; font-size: 12px; color: var(--text-gray);"><strong>Stage:</strong> ${deal.stage}</div>` : ''}
                ${questionsArray.length > 0 ? `
                  <details style="margin-top: 12px; padding: 12px; background: rgba(225,72,73,0.1); border-left: 3px solid var(--danger); border-radius: 4px;">
                    <summary style="cursor: pointer; font-weight: 600; color: var(--danger); font-size: 13px; user-select: none;">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                      </svg>
                      Perguntas de Auditoria IA
                    </summary>
                    <ul style="margin: 12px 0 0 0; padding-left: 20px; font-size: 12px; line-height: 1.7; color: var(--text-gray);">
                      ${questionsArray.map(q => `<li style="margin-bottom: 8px;">${q}</li>`).join('')}
                    </ul>
                  </details>
                ` : ''}
                ${dealInsight ? `
                  <details style="margin-top: 12px; padding: 10px; background: rgba(0,190,255,0.05); border-left: 3px solid var(--primary-cyan); border-radius: 4px;">
                    <summary style="cursor: pointer; font-weight: 600; color: var(--primary-cyan); font-size: 12px; user-select: none;">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                      </svg>
                      Insights da An√°lise de Pipeline
                    </summary>
                    <div style="margin-top: 10px; font-size: 12px; line-height: 1.6; color: var(--text-gray);">
                      ${dealInsight}
                    </div>
                  </details>
                ` : ''}
              </div>
            `;
            container.appendChild(card);
          });
          
          log('[TOP 5] ========== TOP 5 ATUALIZADO COM SUCESSO ==========');
        };
        
        // Armazena todos os deals com quarter para uso global
        window.allDealsWithQuarter = allDeals;

        // Helper function global para criar word cloud
        window.createWordCloud = function(dataArray, containerId, colorScheme = 'default') {
          const container = document.getElementById(containerId);
          if (!container || dataArray.length === 0) {
            if (container) {
              container.innerHTML = '<p style="color: var(--text-gray); text-align: center;">Nenhum dado dispon√≠vel</p>';
            }
            return;
          }
          
          const maxCount = dataArray[0][1];
          const getColor = (count, scheme) => {
            if (scheme === 'success') {
              return count >= maxCount * 0.7 ? 'var(--success)' : 
                     count >= maxCount * 0.4 ? '#10b981' : 
                     'rgba(16,185,129,0.6)';
            } else if (scheme === 'danger') {
              return count >= maxCount * 0.7 ? 'var(--danger)' : 
                     count >= maxCount * 0.4 ? '#f87171' : 
                     'rgba(239,68,68,0.6)';
            } else if (scheme === 'info') {
              return count >= maxCount * 0.7 ? 'var(--primary-cyan)' : 
                     count >= maxCount * 0.4 ? '#00BEFF' : 
                     'rgba(0,190,255,0.6)';
            } else {
              return count >= maxCount * 0.7 ? 'var(--danger)' : 
                     count >= maxCount * 0.4 ? 'var(--warning)' : 
                     'var(--text-gray)';
            }
          };
          
          container.innerHTML = `
            <div style="display: flex; flex-wrap: wrap; gap: 8px; align-items: center; justify-content: center;">
              ${dataArray.map(([label, count]) => {
                const size = 10 + (count / maxCount) * 10;
                const opacity = 0.5 + (count / maxCount) * 0.5;
                const color = getColor(count, colorScheme);
                return `
                  <span style="
                    font-size: ${size}px;
                    color: ${color};
                    opacity: ${opacity};
                    font-weight: 600;
                    padding: 4px 8px;
                    background: rgba(255,255,255,0.05);
                    border-radius: 4px;
                    white-space: nowrap;
                    transition: all 0.3s;
                    cursor: help;
                  " title="${count} ocorr√™ncia${count > 1 ? 's' : ''}">
                    ${label} <span style="font-size: 9px; opacity: 0.7;">(${count})</span>
                  </span>
                `;
              }).join('')}
            </div>
          `;
        };

        // SE√á√ÉO 6: MAPA DE FLAGS DE RISCO
        log('[RENDER] === SE√á√ÉO 6: MAPA DE FLAGS DE RISCO ===');
        const riskFlagsContainer = document.getElementById('exec-risk-flags-container');
        if (riskFlagsContainer && allDeals.length > 0) {
          log('[DATA] Analisando flags de', allDeals.length, 'deals...');
          // Debug: mostra amostra de flags
          const sampleDeal = allDeals.find(d => d.flags);
          if (sampleDeal) {
            log('[DEBUG] Exemplo de flags:', typeof sampleDeal.flags, sampleDeal.flags);
          }
          
          // Extrai todas as flags de risco dos deals
          const allFlags = {};
          allDeals.forEach(deal => {
            if (deal.flags && Array.isArray(deal.flags)) {
              deal.flags.forEach(flag => {
                const flagUpper = String(flag).toUpperCase().trim();
                if (flagUpper) {
                  allFlags[flagUpper] = (allFlags[flagUpper] || 0) + 1;
                }
              });
            } else if (deal.flags && typeof deal.flags === 'string' && deal.flags.trim()) {
              // Se flags for string, tenta separar por v√≠rgula OU pipe
              const separators = deal.flags.includes('|') ? /[|]/ : /[,]/;
              deal.flags.split(separators).forEach(flag => {
                const flagUpper = flag.toUpperCase().trim();
                if (flagUpper && flagUpper !== '-' && flagUpper !== 'N/A') {
                  allFlags[flagUpper] = (allFlags[flagUpper] || 0) + 1;
                }
              });
            }
          });
          
          // Converte para array e ordena por frequ√™ncia
          const flagsArray = Object.entries(allFlags)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 20); // Top 20 flags
          
          log('[DATA] Flags extra√≠das:', Object.keys(allFlags).length, 'tipos √∫nicos');
          log('[DATA] Top 10 flags:', flagsArray.slice(0, 10).map(([flag, count]) => `${flag} (${count}x)`).join(', '));
          
          if (flagsArray.length > 0) {
            // Cria visualiza√ß√£o de mapa de palavras
            const maxCount = flagsArray[0][1];
            riskFlagsContainer.innerHTML = `
              <div style="display: flex; flex-wrap: wrap; gap: 8px; align-items: center; justify-content: center;">
                ${flagsArray.map(([flag, count]) => {
                  const size = 10 + (count / maxCount) * 10; // Tamanho de 10px a 20px
                  const opacity = 0.5 + (count / maxCount) * 0.5; // Opacidade de 0.5 a 1
                  const color = count >= maxCount * 0.7 ? 'var(--danger)' : 
                               count >= maxCount * 0.4 ? 'var(--warning)' : 
                               'var(--text-gray)';
                  return `
                    <span style="
                      font-size: ${size}px;
                      color: ${color};
                      opacity: ${opacity};
                      font-weight: 600;
                      padding: 4px 8px;
                      background: rgba(255,255,255,0.05);
                      border-radius: 4px;
                      white-space: nowrap;
                      transition: all 0.3s;
                      cursor: help;
                    " title="${count} ocorr√™ncia(s)">
                      ${flag} <span style="font-size: 10px; color: var(--text-gray);">(${count})</span>
                    </span>
                  `;
                }).join('')}
              </div>
            `;
          } else {
            riskFlagsContainer.innerHTML = '<p style="color: var(--text-gray); text-align: center;">Nenhuma flag de risco identificada no pipeline</p>';
          }
        }
        
        // SE√á√ÉO 7: LABELS DE A√á√ÉO DO PIPELINE (C√≥d A√ß√£o)
        log('[RENDER] === SE√á√ÉO 7: LABELS DE A√á√ÉO DO PIPELINE ===');
        const actionLabelsContainer = document.getElementById('exec-action-labels-container');
        if (actionLabelsContainer && allDeals.length > 0) {
          const allActionLabels = {};
          allDeals.forEach(deal => {
            const action = deal.codAcao || deal.actionCode;
            if (action && typeof action === 'string' && action.trim() && action !== '-' && action !== 'N/A') {
              const actionUpper = action.toUpperCase().trim();
              allActionLabels[actionUpper] = (allActionLabels[actionUpper] || 0) + 1;
            }
          });
          const actionLabelsArray = Object.entries(allActionLabels).sort((a, b) => b[1] - a[1]).slice(0, 20);
          log('[DATA] Labels de a√ß√£o:', actionLabelsArray.length, 'tipos');
          window.createWordCloud(actionLabelsArray, 'exec-action-labels-container', 'info');
        }
        
        // SE√á√ÉO 8 & 9: PERFIL DE VIT√ìRIAS E PERDAS (Tipo Resultado)
        log('[RENDER] === SE√á√ÉO 8 & 9: PERFIL DE VIT√ìRIAS E PERDAS ===');
        if (DATA.wordClouds) {
          const allWinTypes = {};
          const allLossTypes = {};
          
          // Conta frequ√™ncias de Tipo Resultado
          (DATA.wordClouds.winTypes || []).forEach(type => {
            if (type && type.trim()) {
              allWinTypes[type.trim()] = (allWinTypes[type.trim()] || 0) + 1;
            }
          });
          
          (DATA.wordClouds.lossTypes || []).forEach(type => {
            if (type && type.trim()) {
              allLossTypes[type.trim()] = (allLossTypes[type.trim()] || 0) + 1;
            }
          });
          
          const winTypesArray = Object.entries(allWinTypes).sort((a, b) => b[1] - a[1]).slice(0, 15);
          const lossTypesArray = Object.entries(allLossTypes).sort((a, b) => b[1] - a[1]).slice(0, 15);
          
          log('[DATA] Perfil vit√≥rias:', winTypesArray.length, 'tipos');
          log('[DATA] Perfil perdas:', lossTypesArray.length, 'tipos');
          
          window.createWordCloud(winTypesArray, 'exec-win-types-container', 'success');
          window.createWordCloud(lossTypesArray, 'exec-loss-types-container', 'danger');
        }
        
        // SE√á√ÉO 10 & 11: PADR√ïES DE SUCESSO E PERDA (Labels)
        log('[RENDER] === SE√á√ÉO 10 & 11: PADR√ïES DE SUCESSO E PERDA ===');
        if (DATA.wordClouds) {
          const allWinLabels = {};
          const allLossLabels = {};
          
          // Conta frequ√™ncias
          (DATA.wordClouds.winLabels || []).forEach(label => {
            if (label && label.trim()) {
              allWinLabels[label.trim()] = (allWinLabels[label.trim()] || 0) + 1;
            }
          });
          
          (DATA.wordClouds.lossLabels || []).forEach(label => {
            if (label && label.trim()) {
              allLossLabels[label.trim()] = (allLossLabels[label.trim()] || 0) + 1;
            }
          });
          
          const winLabelsArray = Object.entries(allWinLabels).sort((a, b) => b[1] - a[1]).slice(0, 20);
          const lossLabelsArray = Object.entries(allLossLabels).sort((a, b) => b[1] - a[1]).slice(0, 20);
          
          log('[DATA] Padr√µes sucesso:', winLabelsArray.length, 'labels');
          log('[DATA] Padr√µes perda:', lossLabelsArray.length, 'labels');
          
          window.createWordCloud(winLabelsArray, 'exec-win-labels-container', 'success');
          window.createWordCloud(lossLabelsArray, 'exec-loss-labels-container', 'danger');
        }

        // 1. L10 (mant√©m o c√≥digo existente com valida√ß√µes)
        log('[RENDER] === SE√á√ÉO L10 ===');
        // Reutiliza l10 j√° declarado anteriormente
        log('[DATA] L10 dados:', {
          'netRevenue': formatMoney(safe(l10, 'netRevenue')),
          'bookingsGross': formatMoney(safe(l10, 'bookingsGross')),
          'bookingsCount': safe(l10, 'bookingsCount', 0),
          'pipelineNextWeek': formatMoney(safe(l10, 'pipelineNextWeek')),
          'pipelineQuarter': formatMoney(safe(l10, 'pipelineQuarter')),
          'agingPipeline': safe(l10, 'agingPipeline', 0),
          'predictableRevenue': formatMoney(safe(l10, 'predictableRevenue'))
        });
        setTextSafe('kpi-net', formatMoney(safe(l10, 'netRevenue')));
        setTextSafe('kpi-bookings-gross', formatMoney(safe(l10, 'bookingsGross')));
        setTextSafe('kpi-bookings-count', safe(l10, 'bookingsCount', 0) + ' deals');
        setTextSafe('kpi-next-week', formatMoney(safe(l10, 'pipelineNextWeek')));
        setTextSafe('kpi-quarter', formatMoney(safe(l10, 'pipelineQuarter')));
        setTextSafe('kpi-aging', safe(l10, 'agingPipeline', 0));
        setTextSafe('kpi-predictable', formatMoney(safe(l10, 'predictableRevenue')));

        // Margem por categoria
        log('[RENDER] Processando margens por categoria...');
        const marginContainer = document.getElementById('margin-container');
        if (marginContainer) {
          marginContainer.innerHTML = '';
        const margins = safe(l10, 'marginByCategory', []);
        log('[DATA] Margens:', margins.length, 'categorias');
        if (margins.length > 0) {
          margins.forEach(cat => {
            const card = document.createElement('div');
            card.className = 'margin-card';
            card.innerHTML = `
              <div class="margin-card-title">${cat.category || 'N/A'}</div>
              <div class="margin-card-value">${cat.margin || 0}%</div>
              <div class="margin-card-sub">${cat.count || 0} deals ‚Ä¢ ${formatMoney(cat.revenue || 0)}</div>
            `;
            marginContainer.appendChild(card);
          });
        } else {
          marginContainer.innerHTML = '<div style="color: var(--text-gray); padding: 20px; text-align: center;">Sem dados de margem dispon√≠veis</div>';
        }
        } // fim do if marginContainer

        // 2. APRENDIZADOS (NOVA SE√á√ÉO)
        log('[RENDER] === SE√á√ÉO APRENDIZADOS ===');
        if (DATA.aiAnalysis) {
          log('[DATA] An√°lise de IA dispon√≠vel:', Object.keys(DATA.aiAnalysis));
          const winsInsightsEl = document.getElementById('wins-insights-content');
          if (winsInsightsEl) {
            winsInsightsEl.innerHTML = cleanAIResponse(safe(DATA, 'aiAnalysis.winsInsights', '<i>Analisando...</i>'));
          }
          const lossInsightsEl = document.getElementById('loss-insights-content');
          if (lossInsightsEl) {
            lossInsightsEl.innerHTML = cleanAIResponse(safe(DATA, 'aiAnalysis.lossInsights', '<i>Analisando...</i>'));
          }
        }

        // Top Win Factors
        log('[RENDER] Processando top win factors...');
        const winFactorsDiv = document.getElementById('top-win-factors');
        if (winFactorsDiv) {
          winFactorsDiv.innerHTML = '';
        const winFactors = safe(DATA, 'insights.topWinFactors', []);
        log('[DATA] Win factors:', winFactors.length, winFactors);
        log('[DATA] DATA.insights completo:', JSON.stringify(DATA.insights).substring(0, 200));
        log('[DEBUG] Tipo de topWinFactors:', Array.isArray(DATA.insights?.topWinFactors), typeof DATA.insights?.topWinFactors);
        if (Array.isArray(winFactors) && winFactors.length > 0) {
          winFactors.slice(0, 10).forEach((f, idx) => {
            const item = document.createElement('div');
            item.className = 'deal-card';
            item.innerHTML = `
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <span style="color: var(--text-gray); margin-right: 10px;">#${idx + 1}</span>
                  <span style="font-weight: 600;">${f.factor || 'N/A'}</span>
                </div>
                <span class="badge badge-success">${f.count || 0}x</span>
              </div>
            `;
            winFactorsDiv.appendChild(item);
          });
        } else {
          winFactorsDiv.innerHTML = '<div style="color: var(--text-gray); padding: 20px; text-align: center;">Sem fatores de sucesso identificados ainda</div>';
        }
        } // fim do if winFactorsDiv

        // Top Loss Causes
        log('[RENDER] Processando top loss causes...');
        const lossesDiv = document.getElementById('top-loss-causes');
        if (lossesDiv) {
          lossesDiv.innerHTML = '';
        const lossCauses = safe(DATA, 'insights.topLossCauses', []);
        log('[DATA] Loss causes:', lossCauses.length, lossCauses);
        log('[DEBUG] Tipo de topLossCauses:', Array.isArray(DATA.insights?.topLossCauses), typeof DATA.insights?.topLossCauses);
        if (Array.isArray(lossCauses) && lossCauses.length > 0) {
          lossCauses.slice(0, 10).forEach((c, idx) => {
            const item = document.createElement('div');
            item.className = 'deal-card';
            item.innerHTML = `
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <span style="color: var(--text-gray); margin-right: 10px;">#${idx + 1}</span>
                  <span style="font-weight: 600;">${c.cause || 'N/A'}</span>
                </div>
                <span class="badge badge-danger">${c.count || 0}x</span>
              </div>
            `;
            lossesDiv.appendChild(item);
          });
        } else {
          lossesDiv.innerHTML = '<div style="color: var(--text-gray); padding: 20px; text-align: center;">Sem causas de perda identificadas ainda</div>';
        }
        } // fim do if lossesDiv

        // 3. FSR Performance Table - Separa ativos e inativos
        log('[RENDER] === SE√á√ÉO FSR PERFORMANCE ===');
        const scorecardTable = DATA.fsrScorecard || [];
        const activeRepsTable = scorecardTable.filter(r => r.isActive);
        const inactiveReps = scorecardTable.filter(r => !r.isActive);
        log('[DATA] FSR Scorecard:', activeRepsTable.length, 'ativos,', inactiveReps.length, 'inativos');
        
        // Popula tabela de IPV (Ranking Geral)
        const ipvTableBody = document.getElementById('fsr-ipv-table');
        if (ipvTableBody) {
          ipvTableBody.innerHTML = '';
          if (activeRepsTable.length > 0) {
            activeRepsTable.forEach((fsr, idx) => {
              const tr = document.createElement('tr');
              
              // Determina cor do IPV
              let ipvClass = 'badge-warning';
              const ipv = fsr.ipv || 0;
              if (ipv >= 80) ipvClass = 'badge-success';
              else if (ipv < 50) ipvClass = 'badge-danger';
              
              // Badges coloridos para os pilares (com prote√ß√£o contra undefined)
              const breakdown = fsr.ipvBreakdown || { result: 0, efficiency: 0, behavior: 0 };
              const resultClass = (breakdown.result || 0) >= 70 ? 'badge-success' : 
                                  (breakdown.result || 0) >= 50 ? 'badge-warning' : 'badge-danger';
              const effClass = (breakdown.efficiency || 0) >= 70 ? 'badge-success' : 
                               (breakdown.efficiency || 0) >= 50 ? 'badge-warning' : 'badge-danger';
              const behavClass = (breakdown.behavior || 0) >= 70 ? 'badge-success' : 
                                 (breakdown.behavior || 0) >= 50 ? 'badge-warning' : 'badge-danger';
              
              tr.innerHTML = `
                <td style="font-weight: 700; color: var(--primary-cyan); font-size: 1.2em;">#${idx + 1}</td>
                <td style="font-weight: 600; color: #fff;">${fsr.name || 'N/A'}</td>
                <td><span class="badge ${ipvClass}" style="font-size: 1.1em; padding: 8px 12px;">${ipv}</span></td>
                <td><span class="badge ${resultClass}">${breakdown.result || 0}</span></td>
                <td><span class="badge ${effClass}">${breakdown.efficiency || 0}</span></td>
                <td><span class="badge ${behavClass}">${breakdown.behavior || 0}</span></td>
                <td>${fsr.winRate || 0}%</td>
                <td style="font-weight: 600;">${formatMoney(fsr.totalGrossGenerated || 0)}</td>
              `;
              ipvTableBody.appendChild(tr);
            });
          } else {
            ipvTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-gray);">Sem dados de vendedores ativos</td></tr>';
          }
        }
        
        // Popula tabela de vendedores ATIVOS
        const perfActiveBody = document.getElementById('fsr-performance-active-body');
        if (perfActiveBody) {
          perfActiveBody.innerHTML = '';
        if (activeRepsTable.length > 0) {
          activeRepsTable.forEach(fsr => {
            const tr = document.createElement('tr');
            
            // Determina cor do Win Rate
            let winRateClass = 'badge-warning';
            const wr = fsr.winRate || 0;
            if (wr >= 80) winRateClass = 'badge-success';
            else if (wr < 40) winRateClass = 'badge-danger';
            
            tr.innerHTML = `
              <td style="font-weight: 600; color: #fff;">${fsr.name || 'N/A'}</td>
              <td><span class="badge ${winRateClass}">${wr}%</span></td>
              <td>${fsr.totalWon || 0}</td>
              <td>${fsr.totalLost || 0}</td>
              <td style="color: var(--success);">${fsr.avgWinCycle || 0}d</td>
              <td style="color: var(--danger);">${fsr.avgLossCycle || 0}d</td>
              <td>${formatMoney(fsr.avgGross || 0)}</td>
              <td style="font-weight: 600; color: var(--success);">${formatMoney(fsr.totalGrossGenerated || 0)}</td>
              <td style="font-weight: 600; color: var(--primary-cyan);">${formatMoney(fsr.totalNetGenerated || 0)}</td>
            `;
            perfActiveBody.appendChild(tr);
          });
        } else {
          perfActiveBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: var(--text-gray);">Sem dados de vendedores ativos</td></tr>';
        }
        } // fim do if perfActiveBody
        
        // Popula tabela de vendedores INATIVOS
        const perfInactiveBody = document.getElementById('fsr-performance-inactive-body');
        if (perfInactiveBody) {
          perfInactiveBody.innerHTML = '';
        setTextSafe('inactive-count', inactiveReps.length);
        if (inactiveReps.length > 0) {
          inactiveReps.forEach(fsr => {
            const tr = document.createElement('tr');
            
            let winRateClass = 'badge-warning';
            const wr = fsr.winRate || 0;
            if (wr >= 80) winRateClass = 'badge-success';
            else if (wr < 40) winRateClass = 'badge-danger';
            
            tr.innerHTML = `
              <td style="font-weight: 600; color: var(--text-gray);">${fsr.name || 'N/A'}</td>
              <td><span class="badge ${winRateClass}">${wr}%</span></td>
              <td>${fsr.totalWon || 0}</td>
              <td>${fsr.totalLost || 0}</td>
              <td style="color: var(--text-gray);">${formatMoney(fsr.revenue || 0)}</td>
            `;
            perfInactiveBody.appendChild(tr);
          });
        } else {
          perfInactiveBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-gray);">Nenhum vendedor inativo</td></tr>';
        }
        } // fim do if perfInactiveBody

        // FSR Behavior Table - APENAS ATIVOS
        const behavActiveBody = document.getElementById('fsr-behavior-active-body');
        if (behavActiveBody) {
          behavActiveBody.innerHTML = '';
        if (activeRepsTable.length > 0) {
          activeRepsTable.forEach(fsr => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td style="font-weight: 600; color: #fff;">${fsr.name || 'N/A'}</td>
              <td style="color: var(--success);">${fsr.avgActivitiesWin || 0}</td>
              <td style="color: var(--danger);">${fsr.avgActivitiesLoss || 0}</td>
              <td style="font-size: 12px; color: var(--text-gray);">${fsr.topLossCause || 'N/A'}</td>
              <td style="font-size: 12px; color: var(--text-gray);">${fsr.topWinFactor || 'N/A'}</td>
            `;
            behavActiveBody.appendChild(tr);
          });
        } else {
          behavActiveBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-gray);">Sem dados de vendedores ativos</td></tr>';
        }
        } // fim do if behavActiveBody

        // 4. POR VENDEDOR - Popula selector APENAS COM ATIVOS
        const repSelector = document.getElementById('rep-selector');
        if (repSelector) {
          repSelector.innerHTML = '<option value="">-- Selecione um vendedor --</option>';
          if (activeRepsTable.length > 0) {
            activeRepsTable.forEach((rep, idx) => {
              const option = document.createElement('option');
              option.value = idx;
              option.textContent = rep.name || `Vendedor ${idx + 1}`;
              option.dataset.isActive = 'true'; // Marca como ativo
              repSelector.appendChild(option);
            });
          }
        }

        // 5. Agenda (Pautas por Quarter) - c√≥digo existente mantido
        const agendaContainer = document.getElementById('agenda-container');
        if (agendaContainer) {
          agendaContainer.innerHTML = '';
        
        const quartersAgenda = DATA.weeklyAgenda || {};
        if (Object.keys(quartersAgenda).length === 0) {
          agendaContainer.innerHTML = '<div class="loading">Nenhuma pauta cr√≠tica no momento</div>';
        } else {
          for (const [quarter, deals] of Object.entries(quartersAgenda)) {
            if (!deals || deals.length === 0) continue;
            
            const qDiv = document.createElement('div');
            qDiv.innerHTML = `<h4>${quarter}</h4>`;
            
            deals.forEach(d => {
              const card = document.createElement('div');
              card.className = 'deal-card';
              
              // Determina badge de confian√ßa
              let confidenceBadge = 'badge-warning';
              const conf = d.confidence || 50;
              if (conf >= 70) confidenceBadge = 'badge-success';
              else if (conf < 50) confidenceBadge = 'badge-danger';
              
              card.innerHTML = `
                <div class="deal-header">
                  <div class="deal-name">${d.name || 'Deal sem nome'}</div>
                  <div class="deal-value">${formatMoney(d.val || 0)}</div>
                </div>
                <div class="deal-meta">
                  üë§ ${d.owner || 'N/A'} | 
                  <strong>Stage:</strong> ${d.stage || 'N/A'} | 
                  <span class="badge ${confidenceBadge}">${conf}% confian√ßa</span> | 
                  ${(d.daysToClose || 0) > 0 ? d.daysToClose + ' dias p/ close' : 'Atrasado'}
                </div>
                <div class="deal-audit">
                  ${d.auditQuestions || (d.nextActivity ? 'Pr√≥x: ' + d.nextActivity : 'Sem atividade agendada')}
                </div>
              `;
              qDiv.appendChild(card);
            });
            
            agendaContainer.appendChild(qDiv);
          }
        }
        } // fim do if agendaContainer
        
        // ============================================================================
        // POPULA FILTRO DE VENDEDORES
        // ============================================================================
        populateRepFilter();
        
        log('[RENDER] ========== RENDERIZA√á√ÉO CONCLU√çDA ==========');
        log('[RENDER] Timestamp fim:', new Date().toISOString());
      } catch (error) {
        console.error('‚ùå Erro ao renderizar dashboard:', error);
        document.body.innerHTML = `
          <div style="padding: 40px; text-align: center; color: #fff; background: #1c2b3e; min-height: 100vh;">
            <h2 style="color: #E14849;">‚ö†Ô∏è Erro ao carregar dashboard</h2>
            <p style="color: #b0b8c4; margin: 20px 0;">${error.message}</p>
            <details style="margin-top: 30px; text-align: left; max-width: 800px; margin-left: auto; margin-right: auto; background: #24344d; padding: 20px; border-radius: 8px;">
              <summary style="cursor: pointer; color: #00BEFF; font-weight: 600;">üîç Detalhes T√©cnicos</summary>
              <pre style="margin-top: 15px; color: #e0e6ed; font-size: 12px; overflow-x: auto;">${error.stack || 'Stack trace n√£o dispon√≠vel'}</pre>
            </details>
            <div style="margin-top: 30px;">
              <button onclick="location.reload()" style="
                background: #00BEFF; 
                color: #1c2b3e; 
                border: none; 
                padding: 12px 24px; 
                border-radius: 8px; 
                font-weight: 600; 
                cursor: pointer;
                font-size: 14px;
              ">üîÑ Recarregar Dashboard</button>
            </div>
            <p style="color: #666; font-size: 12px; margin-top: 30px;">
              Se o erro persistir, limpe o cache via menu: <b>Xertica AI > Limpar Cache Web App</b>
            </p>
          </div>
        `;
      }
    }

    // Fun√ß√£o para mostrar detalhes de um vendedor espec√≠fico
    function showRepDetails() {
      const selector = document.getElementById('rep-selector');
      const idx = selector.value;
      const detailsDiv = document.getElementById('rep-details');
      
      if (!idx || idx === '') {
        detailsDiv.style.display = 'none';
        return;
      }
      
      // Busca apenas entre vendedores ativos
      const activeReps = (DATA.fsrScorecard || []).filter(r => r.isActive);
      const rep = activeReps[parseInt(idx)];
      if (!rep) return;
      
      // Mostra a se√ß√£o
      detailsDiv.style.display = 'block';
      
      // Popula dados
      setTextSafe('rep-name-title', rep.name);
      setTextSafe('rep-winrate', rep.winRate + '%');
      setTextSafe('rep-wins', rep.totalWon);
      setTextSafe('rep-losses', rep.totalLost);
      setTextSafe('rep-revenue', formatMoney(rep.revenue));
      setTextSafe('rep-cycle-win', rep.avgWinCycle + 'd');
      setTextSafe('rep-cycle-loss', rep.avgLossCycle + 'd');
      setTextSafe('rep-avg-ticket', formatMoney(rep.avgGross));
      setTextSafe('rep-activities-win', rep.avgActivitiesWin);
      setTextSafe('rep-win-factor', rep.topWinFactor || 'N/A');
      setTextSafe('rep-loss-cause', rep.topLossCause || 'N/A');
      
      // Aplica cor ao Win Rate
      const wrElement = document.getElementById('rep-winrate');
      if (rep.winRate >= 80) wrElement.className = 'kpi-value val-green';
      else if (rep.winRate < 40) wrElement.className = 'kpi-value val-red';
      else wrElement.className = 'kpi-value val-warning';
    }
    
    // ============================================================================
    // NOVA FUN√á√ÉO: Popula KPIs est√°ticos da aba üìä Dashboard_Metrics
    // ============================================================================
    function populateStaticKPIs(metrics) {
      if (!metrics) {
        log('[STATIC] ‚ö†Ô∏è Nenhuma m√©trica est√°tica dispon√≠vel');
        return;
      }
      
      log('[STATIC] Populando KPIs est√°ticos...');
      
      try {
        // Pipeline Total (TODOS OS ANOS) - N√£o muda com filtros
        setTextSafe('exec-pipeline-year-total', formatMoney(metrics.allPipelineGross));
        setTextSafe('exec-pipeline-year-deals', metrics.allPipelineDeals + ' deals abertos');
        setTextSafe('exec-pipeline-year-net', 'Net: ' + formatMoney(metrics.allPipelineNet));
        
        // Pipeline (Per√≠odo Filtrado) - Inicia com todos os anos
        setTextSafe('exec-pipeline-total', formatMoney(metrics.allPipelineGross));
        setTextSafe('exec-pipeline-deals', metrics.allPipelineDeals + ' deals abertos');
        setTextSafe('exec-pipeline-net', 'Net: ' + formatMoney(metrics.allPipelineNet));
        
        // Sales Specialist
        setTextSafe('exec-pipeline-specialist-total', formatMoney(metrics.salesSpecGross));
        setTextSafe('exec-pipeline-specialist-deals', metrics.salesSpecDeals + ' deals curados');
        setTextSafe('exec-pipeline-specialist-net', 'Net: ' + formatMoney(metrics.salesSpecNet));
        
        // Vendedores Ativos
        setTextSafe('exec-active-reps', metrics.activeRepsCount);
        
        // Deals >= 50% Confian√ßa
        setTextSafe('exec-above50-value', formatMoney(metrics.highConfGross));
        setTextSafe('exec-above50-count', metrics.highConfDeals + ' deals');
        setTextSafe('exec-above50-net', 'Net: ' + formatMoney(metrics.highConfNet));
        
        // Confian√ßa M√©dia
        const avgConfPercent = Math.round(metrics.avgConfidence);
        setTextSafe('exec-forecast-percent', avgConfPercent + '% confian√ßa m√©dia');
        
        // Calcula Previs√£o Ponderada (Pipeline Total √ó Confian√ßa M√©dia)
        const forecastWeighted = metrics.allPipelineGross * (metrics.avgConfidence / 100);
        setTextSafe('exec-forecast-weighted', formatMoney(forecastWeighted));
        const forecastNetWeighted = metrics.allPipelineNet * (metrics.avgConfidence / 100);
        setTextSafe('exec-forecast-net', 'Net: ' + formatMoney(forecastNetWeighted));
        
        log('[STATIC] ‚úÖ KPIs est√°ticos populados com sucesso');
        
      } catch (e) {
        log('[STATIC] ‚ùå Erro ao popular KPIs est√°ticos:', e.message);
      }
    }

    // ============================================================================
    // Navega√ß√£o corrigida com argumentos expl√≠citos
    function showSection(element, sectionId) {
      // Remove active de todas as se√ß√µes e nav items
      document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
      
      // Adiciona active ao elemento clicado e √† se√ß√£o correspondente
      document.getElementById(sectionId).classList.add('active');
      element.classList.add('active');
      
      // Atualiza t√≠tulo
      const titles = { 
        'executive': 'Vis√£o Executiva',
        'dashboard': 'Indicadores L10', 
        'insights': 'Aprendizados',
        'fsr': 'Performance FSR',
        'individual': 'Por Vendedor', 
        'agenda': 'Pauta Semanal',
        'ml': 'ü§ñ Intelig√™ncia ML'
      };
      setTextSafe('page-title', titles[sectionId] || 'Dashboard');
      
      // Se aba ML for ativada, carrega predi√ß√µes automaticamente
      if (sectionId === 'ml' && !ML_DATA) {
        loadMLPredictions();
      }
    }

    // Fun√ß√£o para trocar tabs dentro da Vis√£o Executiva
    function switchExecTab(tabName) {
      // Remove active de todos os bot√µes
      document.querySelectorAll('.exec-tab').forEach(tab => {
        tab.classList.remove('active');
        tab.style.color = 'var(--text-gray)';
        tab.style.borderBottom = '3px solid transparent';
      });
      
      // Remove active de todos os conte√∫dos
      document.querySelectorAll('.exec-tab-content').forEach(content => {
        content.classList.remove('active');
        content.style.display = 'none';
      });
      
      // Adiciona active ao bot√£o clicado
      const activeTab = document.querySelector(`.exec-tab[data-tab="${tabName}"]`);
      if (activeTab) {
        activeTab.classList.add('active');
        activeTab.style.color = 'var(--primary-cyan)';
        activeTab.style.borderBottom = '3px solid var(--primary-cyan)';
      }
      
      // Adiciona active ao conte√∫do correspondente
      const activeContent = document.querySelector(`.exec-tab-content[data-content="${tabName}"]`);
      if (activeContent) {
        activeContent.classList.add('active');
        activeContent.style.display = 'block';
      }
    }

    // Fun√ß√£o para expandir/colapsar an√°lise de IA
    function toggleAIAnalysis() {
      const analysisContent = document.getElementById('exec-top-opps-ai-analysis');
      const chevron = document.getElementById('ai-analysis-chevron');
      
      if (analysisContent && chevron) {
        if (analysisContent.style.display === 'none') {
          analysisContent.style.display = 'block';
          chevron.style.transform = 'rotate(0deg)';
        } else {
          analysisContent.style.display = 'none';
          chevron.style.transform = 'rotate(-90deg)';
        }
      }
    }
    
    // Fun√ß√£o para atualizar m√©tricas de convers√£o ao filtrar por per√≠odo
    function updateConversionMetricsForPeriod(period) {
      if (!window.conversionMetrics) {
        log('[CONVERSION] M√©tricas n√£o dispon√≠veis');
        return;
      }
      
      let winsGross = 0, winsNet = 0, lossesGross = 0, lossesNet = 0;
      let totalWins = 0, totalLosses = 0;
      
      // Se per√≠odo for um quarter espec√≠fico, filtra
      const fy = window.currentFY || 'FY26';
      let targetQuarter = null;
      
      if (period === 'q1' || period === 'q2' || period === 'q3' || period === 'q4') {
        targetQuarter = `${fy}-${period.toUpperCase()}`;
      }
      
      // Filtra ganhas pelo per√≠odo
      if (window.wonAgg) {
        window.wonAgg.forEach(deal => {
          // Se targetQuarter √© null ("all"), inclui TODOS os deals
          // Se targetQuarter existe, filtra apenas matching fiscalQ
          if (targetQuarter === null || deal.fiscalQ === targetQuarter) {
            winsGross += deal.gross || 0;
            winsNet += deal.net || 0;
            totalWins++;
          }
        });
      }
      
      // Filtra perdidas pelo per√≠odo
      if (window.lostAgg) {
        window.lostAgg.forEach(deal => {
          // Se targetQuarter √© null ("all"), inclui TODOS os deals
          if (targetQuarter === null || deal.fiscalQ === targetQuarter) {
            lossesGross += deal.gross || 0;
            lossesNet += deal.net || 0;
            totalLosses++;
          }
        });
      }
      
      const totalDeals = totalWins + totalLosses;
      const conversionRate = totalDeals > 0 ? Math.round((totalWins / totalDeals) * 100) : 0;
      
      log('[CONVERSION UPDATE] Per√≠odo:', targetQuarter || 'TODOS');
      log('[CONVERSION] Ganhas: Gross', formatMoney(winsGross), '| Net', formatMoney(winsNet), '|', totalWins, 'deals');
      log('[CONVERSION] Perdidas: Gross', formatMoney(lossesGross), '| Net', formatMoney(lossesNet), '|', totalLosses, 'deals');
      log('[CONVERSION] Taxa:', conversionRate + '%', `(${totalWins}/${totalDeals})`);
      
      // Atualiza o card "Fechado no Quarter" (adaptativo ao filtro)
      setTextSafe('exec-closed-total', formatMoney(winsGross));
      setTextSafe('exec-closed-deals', totalWins + ' deals ganhos');
      setTextSafe('exec-closed-net', 'Net: ' + formatMoney(winsNet));
      
      // Atualiza o card "Taxa de Convers√£o" (adaptativo ao filtro)
      setTextSafe('exec-conversion-rate', conversionRate + '%');
      setTextSafe('exec-conversion-detail', totalWins + '/' + totalDeals + ' deals');
      
      // Atualiza a display da Taxa de Convers√£o
      const conversionCard = document.querySelector('[data-card="conversion"]');
      if (conversionCard) {
        const detailEl = conversionCard.querySelector('[data-detail]');
        if (detailEl) {
          const html = `
            <div style="margin-top: 12px; font-size: 11px; opacity: 0.85; line-height: 1.6;">
              <div><strong>Ganhas:</strong> ${formatMoney(winsGross)} (Gross) | ${formatMoney(winsNet)} (Net)</div>
              <div><strong>Perdidas:</strong> ${formatMoney(lossesGross)} (Gross) | ${formatMoney(lossesNet)} (Net)</div>
              <div style="margin-top: 8px; border-top: 1px solid rgba(176,184,196,0.2); padding-top: 8px;">
                <strong>Resultado L√≠quido (Net):</strong> ${formatMoney(winsNet - lossesNet)}
              </div>
            </div>
          `;
          detailEl.innerHTML += html;
        }
      }
    }
    
    // ============================================================================
    // FUN√á√ÉO PARA ATUALIZAR PREVIS√ÉO PONDERADA IA (ADAPTATIVA AO FILTRO)
    // ============================================================================
    function updateForecastPrediction(period, pipelineData) {
      log('[FORECAST] Recalculando Previs√£o Ponderada IA para per√≠odo:', period);
      
      // IMPORTANTE: A confian√ßa m√©dia GLOBAL vem das m√©tricas est√°ticas (calculada de 270 deals)
      // Para filtros espec√≠ficos, precisamos recalcular com base nos deals dispon√≠veis
      
      let avgConfidence = 0;
      
      if (period === 'all') {
        // Usa confian√ßa m√©dia GLOBAL das m√©tricas est√°ticas (270 deals)
        avgConfidence = (window.STATIC_METRICS && window.STATIC_METRICS.avgConfidence) 
          ? parseFloat(window.STATIC_METRICS.avgConfidence) 
          : 0;
        log('[FORECAST] Usando confian√ßa m√©dia GLOBAL das m√©tricas est√°ticas:', avgConfidence + '%');
      } else {
        // Para filtros espec√≠ficos (total, q1-q4), recalcula com deals dispon√≠veis
        if (!window.allDealsWithConfidence || window.allDealsWithConfidence.length === 0) {
          log('[FORECAST] ‚ö†Ô∏è allDealsWithConfidence n√£o dispon√≠vel, usando m√©trica est√°tica');
          avgConfidence = (window.STATIC_METRICS && window.STATIC_METRICS.avgConfidence) 
            ? parseFloat(window.STATIC_METRICS.avgConfidence) 
            : 0;
        } else {
          const fy = window.currentFY || 'FY26';
          let dealsToAnalyze = [];
          
          if (period === 'total') {
            dealsToAnalyze = window.allDealsWithConfidence.filter(d => 
              (d.fiscalQ || '').startsWith(fy + '-')
            );
            log('[FORECAST] Analisando deals de', fy + ':', dealsToAnalyze.length);
          } else if (['q1', 'q2', 'q3', 'q4'].includes(period)) {
            const targetQuarter = fy + '-' + period.toUpperCase();
            dealsToAnalyze = window.allDealsWithConfidence.filter(d => 
              d.fiscalQ === targetQuarter
            );
            log('[FORECAST] Analisando deals de', targetQuarter + ':', dealsToAnalyze.length);
          }
          
          // Calcula confian√ßa m√©dia dos deals do per√≠odo
          let totalConfidence = 0;
          let dealsWithConfidence = 0;
          
          dealsToAnalyze.forEach(d => {
            let conf = parseFloat(d.confidence) || 0;
            if (conf > 1) conf = conf / 100;
            
            if (conf > 0) {
              totalConfidence += conf;
              dealsWithConfidence++;
            }
          });
          
          avgConfidence = dealsWithConfidence > 0 
            ? (totalConfidence / dealsWithConfidence) * 100 
            : 0;
          
          log('[FORECAST] Confian√ßa m√©dia calculada do per√≠odo:', avgConfidence.toFixed(1) + '%', '(' + dealsWithConfidence + ' deals)');
        }
      }
      
      // Calcula previs√£o ponderada
      const forecastGross = pipelineData.gross * (avgConfidence / 100);
      const forecastNet = pipelineData.net * (avgConfidence / 100);
      
      log('[FORECAST] Previs√£o Ponderada IA:', {
        'pipeline': formatMoney(pipelineData.gross),
        'confian√ßa': avgConfidence.toFixed(1) + '%',
        'previs√£o': formatMoney(forecastGross)
      });
      
      // Atualiza cards
      setTextSafe('exec-forecast-weighted', formatMoney(forecastGross));
      setTextSafe('exec-forecast-percent', Math.round(avgConfidence) + '% confian√ßa m√©dia');
      setTextSafe('exec-forecast-net', 'Net: ' + formatMoney(forecastNet));
    }
    
    // ============================================================================
    // FUN√á√ÉO PARA ATUALIZAR DEALS ‚â•50% CONFIAN√áA IA (ADAPTATIVA AO FILTRO)
    // ============================================================================
    function updateHighConfidenceDeals(period) {
      log('[HIGH-CONF] Recalculando Deals ‚â•50% Confian√ßa IA para per√≠odo:', period);
      
      let highConfGross = 0;
      let highConfNet = 0;
      let highConfCount = 0;
      
      if (period === 'all') {
        // Usa valores GLOBAIS das m√©tricas est√°ticas (270 deals)
        if (window.STATIC_METRICS) {
          highConfGross = window.STATIC_METRICS.highConfGross || 0;
          highConfNet = window.STATIC_METRICS.highConfNet || 0;
          highConfCount = window.STATIC_METRICS.highConfDeals || 0;
          log('[HIGH-CONF] Usando valores GLOBAIS das m√©tricas est√°ticas:', highConfCount, 'deals');
        }
      } else {
        // Para filtros espec√≠ficos, recalcula com deals dispon√≠veis
        if (!window.allDealsWithConfidence || window.allDealsWithConfidence.length === 0) {
          log('[HIGH-CONF] ‚ö†Ô∏è allDealsWithConfidence n√£o dispon√≠vel');
          return;
        }
        
        const fy = window.currentFY || 'FY26';
        let dealsToAnalyze = [];
        
        if (period === 'total') {
          dealsToAnalyze = window.allDealsWithConfidence.filter(d => 
            (d.fiscalQ || '').startsWith(fy + '-')
          );
          log('[HIGH-CONF] Analisando deals de', fy + ':', dealsToAnalyze.length);
        } else if (['q1', 'q2', 'q3', 'q4'].includes(period)) {
          const targetQuarter = fy + '-' + period.toUpperCase();
          dealsToAnalyze = window.allDealsWithConfidence.filter(d => 
            d.fiscalQ === targetQuarter
          );
          log('[HIGH-CONF] Analisando deals de', targetQuarter + ':', dealsToAnalyze.length);
        }
        
        // Filtra deals com confian√ßa >= 50%
        dealsToAnalyze.forEach(d => {
          let conf = parseFloat(d.confidence) || 0;
          if (conf > 1) conf = conf / 100;
          
          if (conf >= 0.50) {
            highConfGross += parseFloat(d.gross) || 0;
            highConfNet += parseFloat(d.net) || 0;
            highConfCount++;
          }
        });
        
        log('[HIGH-CONF] Deals ‚â•50% calculados do per√≠odo:', highConfCount, 'deals');
      }
      
      log('[HIGH-CONF] Deals ‚â•50%:', {
        'total': highConfCount,
        'gross': formatMoney(highConfGross),
        'net': formatMoney(highConfNet)
      });
      
      // Atualiza cards
      setTextSafe('exec-above50-value', formatMoney(highConfGross));
      setTextSafe('exec-above50-count', highConfCount + ' deals');
      setTextSafe('exec-above50-net', 'Net: ' + formatMoney(highConfNet));
    }
    
    // Fun√ß√£o para filtrar pipeline por per√≠odo
    function filterPipeline(period) {
      log('[FILTER] ========== FILTRO DE PIPELINE ==========');
      log('[FILTER] Per√≠odo selecionado:', period);
      
      // Armazena filtro atual para debug
      window.currentPeriodFilter = period;
      
      if (!window.pipelineData) {
        log('[FILTER] ‚ö†Ô∏è pipelineData n√£o dispon√≠vel');
        return;
      }
      
      const data = window.pipelineData[period];
      if (!data) {
        log('[FILTER] ‚ö†Ô∏è Dados do per√≠odo n√£o encontrados:', period);
        return;
      }
      
      // ============================================================================
      // ARQUITETURA H√çBRIDA: FILTROS DIN√ÇMICOS
      // ============================================================================
      // Esta fun√ß√£o manipula APENAS dados DIN√ÇMICOS do payload JSON (window.pipelineData)
      // KPIs EST√ÅTICOS (Pipeline Total, Vendedores Ativos) v√™m da aba e N√ÉO s√£o recalculados aqui
      // 
      // REGRAS:
      // - "Pipeline Total Ano" (exec-pipeline-year-*) ‚Üí EST√ÅTICO (da aba)
      // - "Pipeline (Per√≠odo Filtrado)" (exec-pipeline-*) ‚Üí DIN√ÇMICO (recalculado aqui)
      // - "Top 5 Oportunidades" ‚Üí DIN√ÇMICO (filtrado por quarter)
      // - "Sa√∫de do Forecast" ‚Üí DIN√ÇMICO (recalculado por per√≠odo)
      // ============================================================================
      
      log('[FILTER] Aplicando filtro:', {
        'per√≠odo': period,
        'gross': formatMoney(data.gross),
        'net': formatMoney(data.net),
        'deals': data.count
      });
      
      // ATUALIZA APENAS O CARD "Pipeline (Per√≠odo Filtrado)"
      // O card "Pipeline Total Ano" (exec-pipeline-year-*) √© EST√ÅTICO e N√ÉO √© alterado
      setTextSafe('exec-pipeline-total', formatMoney(data.gross));
      setTextSafe('exec-pipeline-deals', data.count + ' deals no per√≠odo');
      setTextSafe('exec-pipeline-net', 'Net: ' + formatMoney(data.net));
      
      // RECALCULA PREVIS√ÉO PONDERADA IA ADAPTATIVA AO FILTRO
      updateForecastPrediction(period, data);
      
      // RECALCULA DEALS ‚â•50% CONFIAN√áA IA ADAPTATIVA AO FILTRO
      updateHighConfidenceDeals(period);
      
      // Atualiza m√©tricas de convers√£o (Ganhas/Perdidas com Gross/Net)
      updateConversionMetricsForPeriod(period);
      
      // Atualiza Sales Specialist por quarter (Closed Date)
      if (window.salesSpecData) {
        const salesAll = window.salesSpecData.all || { gross: 0, net: 0, count: 0 };
        const byFiscalQ = window.salesSpecData.byFiscalQ || {};
        const fy = window.currentFY || 'FY26';

        if (period === 'q1' || period === 'q2' || period === 'q3' || period === 'q4') {
          const fiscalLabel = `${fy}-${period.toUpperCase()}`;
          const spec = byFiscalQ[fiscalLabel] || { gross: 0, net: 0, count: 0 };
          setTextSafe('exec-pipeline-specialist-total', formatMoney(spec.gross));
          setTextSafe('exec-pipeline-specialist-deals', spec.count + ' deals curados');
          setTextSafe('exec-pipeline-specialist-net', 'Net: ' + formatMoney(spec.net));
        } else {
          setTextSafe('exec-pipeline-specialist-total', formatMoney(salesAll.gross));
          setTextSafe('exec-pipeline-specialist-deals', salesAll.count + ' deals curados');
          setTextSafe('exec-pipeline-specialist-net', 'Net: ' + formatMoney(salesAll.net));
        }
      }
      
      // Recalcula Sa√∫de do Forecast para o per√≠odo
      if (window.updateForecastHealth) {
        log('[FILTER] Atualizando sa√∫de do forecast...');
        window.updateForecastHealth(period);
      }
      
      // Atualiza Top 5 Oportunidades por per√≠odo
      if (window.updateTop5Opps) {
        log('[FILTER] Atualizando Top 5 Oportunidades...');
        window.updateTop5Opps(period);
      }
      
      // Atualiza bot√µes
      document.querySelectorAll('.period-filter').forEach(btn => {
        btn.classList.remove('active');
        btn.style.border = '1px solid rgba(176,184,196,0.3)';
        btn.style.background = 'transparent';
        btn.style.color = 'var(--text-gray)';
        btn.style.fontWeight = '500';
        btn.style.boxShadow = '0 1px 2px rgba(0,0,0,0.05)';
      });
      
      const activeBtn = document.querySelector(`.period-filter[data-period="${period}"]`);
      if (activeBtn) {
        activeBtn.classList.add('active');
        activeBtn.style.border = '1px solid var(--primary-cyan)';
        activeBtn.style.background = 'rgba(0,190,255,0.15)';
        activeBtn.style.color = 'var(--primary-cyan)';
        activeBtn.style.fontWeight = '600';
        activeBtn.style.boxShadow = '0 2px 4px rgba(0,190,255,0.2)';
      }
      
      log('[FILTER] ========== FILTRO APLICADO COM SUCESSO ==========');
    }

    // Fun√ß√£o para popular dropdown de vendedores ativos
    function populateRepFilter() {
      if (!DATA.fsrScorecard) {
        log('[REP FILTER] fsrScorecard n√£o dispon√≠vel');
        return;
      }
      
      const activeReps = DATA.fsrScorecard.filter(r => r.isActive);
      const select = document.getElementById('rep-filter');
      
      if (!select) {
        log('[REP FILTER] ‚ö†Ô∏è Elemento select n√£o encontrado');
        return;
      }
      
      // Limpa options existentes (exceto "Todos")
      while (select.options.length > 1) {
        select.remove(1);
      }
      
      // Adiciona vendedores ativos ordenados por nome
      activeReps
        .sort((a, b) => a.name.localeCompare(b.name))
        .forEach(rep => {
          const option = document.createElement('option');
          option.value = rep.name;
          option.text = rep.name;
          select.add(option);
        });
      
      log('[REP FILTER] ‚úÖ Dropdown populado com', activeReps.length, 'vendedores ativos');
    }

    // Fun√ß√£o para filtrar por vendedor
    function filterByRep(repName) {
      log('[REP FILTER] ========== FILTRO POR VENDEDOR ==========');
      log('[REP FILTER] Vendedor selecionado:', repName);
      
      // Armazena filtro atual
      window.currentRepFilter = repName;
      
      if (repName === 'all') {
        log('[REP FILTER] Exibindo todos os vendedores');
        // Reaplica o filtro de per√≠odo atual (sem filtro de vendedor)
        const currentPeriod = window.currentPeriodFilter || 'all';
        filterPipeline(currentPeriod);
        return;
      }
      
      // Filtra pelo vendedor selecionado
      if (!DATA.fsrScorecard) {
        log('[REP FILTER] ‚ö†Ô∏è fsrScorecard n√£o dispon√≠vel');
        return;
      }
      
      const rep = DATA.fsrScorecard.find(r => r.name === repName);
      if (!rep) {
        log('[REP FILTER] ‚ö†Ô∏è Vendedor n√£o encontrado:', repName);
        return;
      }
      
      log('[REP FILTER] Dados do vendedor:', {
        nome: rep.name,
        pipeline: formatMoney(rep.pipeline || 0),
        revenue: formatMoney(rep.revenue || 0),
        revenueGross: formatMoney(rep.revenueGross || 0),
        totalWonQuarter: rep.totalWonQuarter || 0,
        totalWon: rep.totalWon || 0,
        totalLost: rep.totalLost || 0
      });
      
      // Atualiza "Fechado no Quarter" com dados do vendedor (APENAS QUARTER ATUAL)
      const currentQuarter = window.currentQuarterLabel || safe(DATA, 'cloudAnalysis.closed_analysis.closed_quarter.quarter', 'FY26-Q1');
      const repWons = (window.wonAgg || []).filter(d => d.owner === rep.name && d.fiscalQ === currentQuarter);
      const repGross = repWons.reduce((sum, d) => sum + (d.gross || 0), 0);
      const repNet = repWons.reduce((sum, d) => sum + (d.net || 0), 0);
      setTextSafe('exec-closed-total', formatMoney(repGross));
      setTextSafe('exec-closed-net', 'Net: ' + formatMoney(repNet));
      setTextSafe('exec-closed-deals', repWons.length + ' deals ganhos');
      setTextSafe('exec-closed-deals', (rep.totalWonQuarter || 0) + ' deals ganhos');
      setTextSafe('exec-closed-net', 'Net: ' + formatMoney(rep.revenue || 0));
      
      // Atualiza "Taxa de Convers√£o" com dados do vendedor
      const totalDealsRep = (rep.totalWon || 0) + (rep.totalLost || 0);
      const conversionRep = totalDealsRep > 0 ? Math.round(((rep.totalWon || 0) / totalDealsRep) * 100) : 0;
      setTextSafe('exec-conversion-rate', conversionRep + '%');
      setTextSafe('exec-conversion-detail', (rep.totalWon || 0) + '/' + totalDealsRep + ' deals');
      
      // Filtra deals abertos do vendedor no weeklyAgenda
      let repDealsGross = 0;
      let repDealsNet = 0;
      let repDealsCount = 0;
      let repDealsAbove50Gross = 0;
      let repDealsAbove50Net = 0;
      let repDealsAbove50Count = 0;
      
      if (DATA.weeklyAgenda) {
        Object.values(DATA.weeklyAgenda).forEach(quarterDeals => {
          if (Array.isArray(quarterDeals)) {
            quarterDeals.forEach(d => {
              if (d.owner === repName) {
                repDealsGross += d.val || 0;
                repDealsNet += d.net || 0;
                repDealsCount++;
                
                const conf = (d.confidence || 0) > 1 ? (d.confidence / 100) : (d.confidence || 0);
                if (conf >= 0.50) {
                  repDealsAbove50Gross += d.val || 0;
                  repDealsAbove50Net += d.net || 0;
                  repDealsAbove50Count++;
                }
              }
            });
          }
        });
      }
      
      log('[REP FILTER] Pipeline do vendedor:', {
        gross: formatMoney(repDealsGross),
        net: formatMoney(repDealsNet),
        count: repDealsCount,
        above50Gross: formatMoney(repDealsAbove50Gross),
        above50Count: repDealsAbove50Count
      });
      
      // Atualiza "Pipeline (Per√≠odo Filtrado)" - usa pipeline do vendedor
      setTextSafe('exec-pipeline-total', formatMoney(rep.pipeline || 0));
      setTextSafe('exec-pipeline-deals', repDealsCount + ' deals do vendedor');
      setTextSafe('exec-pipeline-net', 'Net: ' + formatMoney(repDealsNet));
      
      // Atualiza "Deals ‚â•50% Confian√ßa IA"
      setTextSafe('exec-above50-value', formatMoney(repDealsAbove50Gross));
      setTextSafe('exec-above50-count', repDealsAbove50Count + ' deals');
      setTextSafe('exec-above50-net', 'Net: ' + formatMoney(repDealsAbove50Net));
      
      log('[REP FILTER] ========== FILTRO APLICADO ==========');
    }

    // Fun√ß√£o para atualizar dashboard (limpa cache e recarrega)
    function refreshDashboard() {
      const btn = document.querySelector('.refresh-btn');
      btn.classList.add('loading');
      btn.innerHTML = '‚è≥';
      
      // Adiciona par√¢metro de timestamp para for√ßar bypass de cache
      const url = new URL(window.location.href);
      url.searchParams.set('nocache', Date.now());
      
      // Recarrega com novo URL
      window.location.href = url.toString();
    }

    // ============================================================================
    // FUN√á√ïES ML INTELLIGENCE 
    // ============================================================================
    
    let ML_DATA = null;

    function loadMLPredictions() {
      log('[ML] Carregando predi√ß√µes...');
      document.getElementById('ml-content-area').innerHTML = '<div class="loading">ü§ñ Carregando predi√ß√µes ML...</div>';
      
      google.script.run
        .withSuccessHandler(function(response) {
          ML_DATA = typeof response === 'string' ? JSON.parse(response) : response;
          log('[ML] ‚úÖ Dados ML carregados');
          switchMLTab('previsao-ciclo');
        })
        .withFailureHandler(function(error) {
          console.error('[ML] ‚ùå Erro:', error);
          document.getElementById('ml-content-area').innerHTML = '<div class="ai-card"><h2 style="color:var(--danger);">‚ùå Erro ao carregar ML</h2></div>';
        })
        .getMLPredictions();
    }

    function switchMLTab(tabName) {
      document.querySelectorAll('.ml-tab').forEach(tab => {
        tab.classList.remove('active');
        tab.style.color = 'var(--text-gray)';
        tab.style.borderBottom = '3px solid transparent';
      });
      
      const activeTab = document.querySelector(`.ml-tab[data-tab="${tabName}"]`);
      if (activeTab) {
        activeTab.classList.add('active');
        activeTab.style.color = 'var(--primary-cyan)';
        activeTab.style.borderBottom = '3px solid var(--primary-cyan)';
      }
      
      if (!ML_DATA) return;
      
      if (tabName === 'previsao-ciclo') renderPrevisaoCiclo();
      else if (tabName === 'classificador-perda') renderClassificadorPerda();
      else if (tabName === 'risco-abandono') renderRiscoAbandono();
      else if (tabName === 'performance-vendedor') renderPerformanceVendedor();
      else if (tabName === 'prioridade-deals') renderPrioridadeDeals();
      else if (tabName === 'proxima-acao') renderProximaAcao();
    }

    // Render functions (simplified for space - complete versions inline)
    function renderPrevisaoCiclo() {
      const data = ML_DATA.previsao_ciclo;
      if (!data?.enabled) {
        document.getElementById('ml-content-area').innerHTML = '<div class="ai-card"><h2 style="color:var(--warning);">‚ö†Ô∏è Modelo Indispon√≠vel</h2></div>';
        return;
      }
      const s = data.summary;
      const deals = [...(data.deals || [])].sort((a,b) => (b.dias_previstos||0)-(a.dias_previstos||0)).slice(0,15);
      let html = `<div class="kpi-grid">
        <div class="kpi-card"><div class="kpi-title">Deals</div><div class="kpi-value val-cyan">${data.total_deals}</div></div>
        <div class="kpi-card"><div class="kpi-title">Ciclo M√©dio</div><div class="kpi-value val-cyan">${Math.round(s.avg_dias_previstos||0)}d</div></div>
        <div class="kpi-card"><div class="kpi-title">R√°pidos</div><div class="kpi-value val-green">${s.rapidos||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">Lentos</div><div class="kpi-value val-warning">${(s.lentos||0)+(s.muito_lentos||0)}</div></div>
      </div><h4>‚è±Ô∏è Top 15 Deals Mais Lentos</h4><table><thead><tr><th>Deal</th><th>Vendedor</th><th>Valor</th><th>Dias</th><th>Velocidade</th></tr></thead><tbody>`;
      deals.forEach(d => html += `<tr><td style="font-weight:600;">${d.opportunity||'N/A'}</td><td>${d.Vendedor||'N/A'}</td><td style="font-weight:600;">${formatMoney(d.Gross_Value||0)}</td><td class="${d.velocidade_prevista==='MUITO_LENTO'?'val-red':d.velocidade_prevista==='LENTO'?'val-warning':'val-cyan'}" style="font-weight:700;">${Math.round(d.dias_previstos||0)}d</td><td><span class="badge badge-${d.velocidade_prevista==='R√ÅPIDO'?'success':d.velocidade_prevista==='NORMAL'?'warning':'danger'}">${d.velocidade_prevista||'N/A'}</span></td></tr>`);
      html += '</tbody></table>';
      document.getElementById('ml-content-area').innerHTML = html;
    }

    function renderClassificadorPerda() {
      const data = ML_DATA.classificador_perda;
      if (!data?.enabled) { document.getElementById('ml-content-area').innerHTML = '<div class="ai-card"><h2 style="color:var(--warning);">‚ö†Ô∏è Modelo Indispon√≠vel</h2></div>'; return; }
      const s = data.summary;
      const deals = [...(data.deals || [])].sort((a,b) => (b.confianca_predicao||0)-(a.confianca_predicao||0)).slice(0,15);
      let html = `<div class="kpi-grid">
        <div class="kpi-card"><div class="kpi-title">PRE√áO</div><div class="kpi-value val-red">${s.preco||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">TIMING</div><div class="kpi-value val-warning">${s.timing||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">CONCORRENTE</div><div class="kpi-value val-red">${s.concorrente||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">BUDGET</div><div class="kpi-value val-warning">${s.budget||0}</div></div>
      </div><h4>‚ùå Top 15 em Risco de Perda</h4><table><thead><tr><th>Deal</th><th>Vendedor</th><th>Valor</th><th>Causa</th><th>Confian√ßa</th></tr></thead><tbody>`;
      deals.forEach(d => html += `<tr><td style="font-weight:600;">${d.opportunity||'N/A'}</td><td>${d.Vendedor||'N/A'}</td><td style="font-weight:600;">${formatMoney(d.Gross_Value||0)}</td><td><span class="badge badge-${d.causa_prevista==='PRECO'||d.causa_prevista==='CONCORRENTE'?'danger':'warning'}">${d.causa_prevista||'N/A'}</span></td><td class="val-cyan" style="font-weight:700;">${Math.round((d.confianca_predicao||0)*100)}%</td></tr>`);
      html += '</tbody></table>';
      document.getElementById('ml-content-area').innerHTML = html;
    }

    function renderRiscoAbandono() {
      const data = ML_DATA.risco_abandono;
      if (!data?.enabled) { document.getElementById('ml-content-area').innerHTML = '<div class="ai-card"><h2 style="color:var(--warning);">‚ö†Ô∏è Modelo Indispon√≠vel</h2></div>'; return; }
      const s = data.summary;
      const deals = [...(data.deals || [])].sort((a,b) => (b.prob_abandono||0)-(a.prob_abandono||0)).slice(0,15);
      let html = `<div class="kpi-grid">
        <div class="kpi-card"><div class="kpi-title">ALTO Risco</div><div class="kpi-value val-red">${s.alto_risco||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">M√âDIO Risco</div><div class="kpi-value val-warning">${s.medio_risco||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">BAIXO Risco</div><div class="kpi-value val-green">${s.baixo_risco||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">Prob M√©dia</div><div class="kpi-value val-cyan">${Math.round((s.avg_prob_abandono||0)*100)}%</div></div>
      </div><h4>üö® Top 15 em Risco de Abandono</h4><table><thead><tr><th>Deal</th><th>Vendedor</th><th>Valor</th><th>N√≠vel</th><th>Prob.</th></tr></thead><tbody>`;
      deals.forEach(d => html += `<tr><td style="font-weight:600;">${d.opportunity||'N/A'}</td><td>${d.Vendedor||'N/A'}</td><td style="font-weight:600;">${formatMoney(d.Gross_Value||0)}</td><td><span class="badge badge-${d.nivel_risco==='ALTO'?'danger':d.nivel_risco==='M√âDIO'?'warning':'success'}">${d.nivel_risco||'N/A'}</span></td><td class="val-red" style="font-weight:700;">${Math.round((d.prob_abandono||0)*100)}%</td></tr>`);
      html += '</tbody></table>';
      document.getElementById('ml-content-area').innerHTML = html;
    }

    function renderPerformanceVendedor() {
      const data = ML_DATA.performance_vendedor;
      if (!data?.enabled) { document.getElementById('ml-content-area').innerHTML = '<div class="ai-card"><h2 style="color:var(--warning);">‚ö†Ô∏è Modelo Indispon√≠vel</h2></div>'; return; }
      const s = data.summary;
      const sellers = [...(data.sellers || [])].sort((a,b) => (a.ranking||999)-(b.ranking||999));
      let html = `<div class="kpi-grid">
        <div class="kpi-card"><div class="kpi-title">Sobre-performando</div><div class="kpi-value val-green">${s.sobre_performando||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">Na Meta</div><div class="kpi-value val-cyan">${s.na_meta||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">Abaixo Meta</div><div class="kpi-value val-warning">${s.abaixo_meta||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">Win Rate M√©dio</div><div class="kpi-value val-cyan">${Math.round((s.avg_win_rate||0)*100)}%</div></div>
      </div><h4>üë§ Ranking de Performance</h4><table><thead><tr><th>#</th><th>Vendedor</th><th>Win Rate</th><th>Delta</th><th>Valor</th><th>Classe</th></tr></thead><tbody>`;
      sellers.forEach(v => html += `<tr><td style="font-weight:700;color:var(--primary-cyan);">#${v.ranking||'N/A'}</td><td style="font-weight:600;">${v.Vendedor||'N/A'}</td><td class="val-cyan" style="font-weight:700;">${Math.round((v.win_rate_previsto||0)*100)}%</td><td class="${(v.delta_performance||0)>0?'val-green':'val-red'}" style="font-weight:600;">${((v.delta_performance||0)>0?'+':'') + Math.round((v.delta_performance||0)*100)}%</td><td style="font-weight:600;">${formatMoney(v.valor_previsto_venda||0)}</td><td><span class="badge badge-${v.classificacao==='SOBRE_PERFORMANDO'||v.classificacao==='PERFORMANDO_BEM'?'success':v.classificacao==='NA_META'?'warning':'danger'}">${v.classificacao||'N/A'}</span></td></tr>`);
      html += '</tbody></table>';
      document.getElementById('ml-content-area').innerHTML = html;
    }

    function renderPrioridadeDeals() {
      const data = ML_DATA.prioridade_deals;
      if (!data?.enabled) { document.getElementById('ml-content-area').innerHTML = '<div class="ai-card"><h2 style="color:var(--warning);">‚ö†Ô∏è Modelo Indispon√≠vel</h2></div>'; return; }
      const s = data.summary;
      const deals = [...(data.deals || [])].sort((a,b) => (a.ranking_global||999)-(b.ranking_global||999)).slice(0,20);
      let html = `<div class="kpi-grid">
        <div class="kpi-card"><div class="kpi-title">CR√çTICO</div><div class="kpi-value val-red">${s.critico||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">ALTO</div><div class="kpi-value val-warning">${s.alto||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">M√âDIO</div><div class="kpi-value val-cyan">${s.medio||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">Score M√©dio</div><div class="kpi-value val-cyan">${Math.round(s.avg_priority_score||0)}</div></div>
      </div><h4>‚≠ê Top 20 Prioridade M√ÅXIMA</h4><table><thead><tr><th>#</th><th>Deal</th><th>Vendedor</th><th>Valor</th><th>Score</th><th>N√≠vel</th></tr></thead><tbody>`;
      deals.forEach(d => html += `<tr><td style="font-weight:700;color:var(--primary-cyan);">#${d.ranking_global||'N/A'}</td><td style="font-weight:600;">${d.opportunity||'N/A'}</td><td>${d.Vendedor||'N/A'}</td><td style="font-weight:600;">${formatMoney(d.Gross_Value||0)}</td><td class="val-cyan" style="font-weight:700;font-size:16px;">${Math.round(d.priority_score||0)}</td><td><span class="badge badge-${d.priority_level==='CR√çTICO'?'danger':d.priority_level==='ALTO'?'warning':'warning'}">${d.priority_level||'N/A'}</span></td></tr>`);
      html += '</tbody></table>';
      document.getElementById('ml-content-area').innerHTML = html;
    }

    function renderProximaAcao() {
      const data = ML_DATA.proxima_acao;
      if (!data?.enabled) { document.getElementById('ml-content-area').innerHTML = '<div class="ai-card"><h2 style="color:var(--warning);">‚ö†Ô∏è Modelo Indispon√≠vel</h2></div>'; return; }
      const s = data.summary;
      const urgOrder = {'ALTA': 1, 'M√âDIA': 2, 'BAIXA': 3};
      const deals = [...(data.deals || [])].sort((a,b) => {
        const urgA = urgOrder[a.urgencia] || 9;
        const urgB = urgOrder[b.urgencia] || 9;
        return urgA !== urgB ? urgA - urgB : (b.Gross_Value||0) - (a.Gross_Value||0);
      }).slice(0,25);
      let html = `<div class="kpi-grid">
        <div class="kpi-card"><div class="kpi-title">URGENTES</div><div class="kpi-value val-red">${s.urgentes||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">M√âDIAS</div><div class="kpi-value val-warning">${s.medias||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">BAIXAS</div><div class="kpi-value val-cyan">${s.baixas||0}</div></div>
        <div class="kpi-card"><div class="kpi-title">Top Categoria</div><div class="kpi-value val-cyan" style="font-size:14px;">${Object.keys(s.top_categorias||{})[0]||'N/A'}</div></div>
      </div><h4>üí° Top 25 A√ß√µes Priorit√°rias</h4><table><thead><tr><th>Deal</th><th>Vendedor</th><th>Valor</th><th>Urg√™ncia</th><th>A√ß√£o Recomendada</th></tr></thead><tbody>`;
      deals.forEach(d => html += `<tr><td style="font-weight:600;">${d.opportunity||'N/A'}</td><td>${d.Vendedor||'N/A'}</td><td style="font-weight:600;">${formatMoney(d.Gross_Value||0)}</td><td><span class="badge badge-${d.urgencia==='ALTA'?'danger':d.urgencia==='M√âDIA'?'warning':'success'}">${d.urgencia||'N/A'}</span></td><td style="font-size:12px;max-width:300px;">${d.acao_recomendada||'N/A'}</td></tr>`);
      html += '</tbody></table>';
      document.getElementById('ml-content-area').innerHTML = html;
    }
  </script>
</body>
</html>
